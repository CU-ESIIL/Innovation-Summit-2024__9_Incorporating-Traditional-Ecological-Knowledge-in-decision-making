
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Summit 2024 Group 9">
      
      
        <meta name="author" content="ESIIL staff">
      
      
        <link rel="canonical" href="https://cu-esiil.github.io/innovation-summit-2024-group-9/worksheets/worksheet_redlining/">
      
      <link rel="icon" href="../../assets/esiil_content/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-8.5.10">
    
    
      
        <title>Explore an example (teacher edition) - ESIIL Innovation Summit 2024 Group 9</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#redlining" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ESIIL Innovation Summit 2024 Group 9" class="md-header__button md-logo" aria-label="ESIIL Innovation Summit 2024 Group 9" data-md-component="logo">
      
  <img src="../../assets/esiil_content/ESIIL_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ESIIL Innovation Summit 2024 Group 9
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Explore an example (teacher edition)
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: white)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/CU-ESIIL/Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../virtual-meetings/" class="md-tabs__link">
        Pre-Summit Virtual Trainings
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../worksheet_0/" class="md-tabs__link md-tabs__link--active">
        Group activities
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../agenda/" class="md-tabs__link">
        Additional resources
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ESIIL Innovation Summit 2024 Group 9" class="md-nav__button md-logo" aria-label="ESIIL Innovation Summit 2024 Group 9" data-md-component="logo">
      
  <img src="../../assets/esiil_content/ESIIL_logo.png" alt="logo">

    </a>
    ESIIL Innovation Summit 2024 Group 9
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CU-ESIIL/Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Pre-Summit Virtual Trainings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pre-Summit Virtual Trainings" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Pre-Summit Virtual Trainings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual-meetings/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Head in the clouds
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Head in the clouds" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Head in the clouds
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/markdown_basics/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/github_basics/" class="md-nav__link">
        Github
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_basics/" class="md-nav__link">
        Cyverse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_hacks/" class="md-nav__link">
        Cyverse hacks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Feet on the ground
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Feet on the ground" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Feet on the ground
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_startup/" class="md-nav__link">
        Startup procedure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data-library/move-data-to-instance/" class="md-nav__link">
        Move and Save data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data-library/stac_mount_save/" class="md-nav__link">
        Stream data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data-library/stac_simple/" class="md-nav__link">
        Stream data (light)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_shutdown/" class="md-nav__link">
        Shutdown procedure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trainings/training_three/" class="md-nav__link">
        Voices in Concert
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Group activities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Group activities" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Group activities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Day 1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 1" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Day 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../worksheet_0/" class="md-nav__link">
        Explore an example (student edition)
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Explore an example (teacher edition)
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../worksheet_2/" class="md-nav__link">
        Make a plan
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Day 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 2" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Day 2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../worksheet_3/" class="md-nav__link">
        Innovate as a team
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Day 3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 3" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Day 3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../worksheet_4/" class="md-nav__link">
        Share your progress
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Additional resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Additional resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Additional resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../agenda/" class="md-nav__link">
        Agenda
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSfibPgHoYytmKvHkDiMxxbTNwdSupB2V2R_2zJC6BBw9asRMA/viewform" class="md-nav__link">
        Anonymous feedback form
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/code-of-conduct/" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/participant_agreement/" class="md-nav__link">
        Participant Agreement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/cyverse_hacks/" class="md-nav__link">
        Cyverse hacks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/useful_links/" class="md-nav__link">
        Useful links
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/CU-ESIIL/Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making/edit/main/docs/worksheets/worksheet_redlining.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="redlining">Redlining<a class="headerlink" href="#redlining" title="Permanent link">&para;</a></h1>
<h1 id="exploring-the-impact-of-historical-redlining-on-urban-greenspace-a-collaborative-examination-of-maps-justice-and-resilience">Exploring the Impact of Historical Redlining on Urban Greenspace: A Collaborative Examination of Maps, Justice, and Resilience<a class="headerlink" href="#exploring-the-impact-of-historical-redlining-on-urban-greenspace-a-collaborative-examination-of-maps-justice-and-resilience" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This group exploration delves into the long-term impacts of historical
redlining on urban greenspace, emphasizing the powerful role of maps in
shaping environmental and social landscapes. By drawing on the research
by Nardone et al. (2021), you will collaboratively investigate how
discriminatory practices encoded in maps have led to persistent
disparities in urban settings. This exploration aims to uncover the
resilience of communities in adapting to these entrenched injustices and
to foster a deeper understanding of how mapping can serve both as a tool
of exclusion and as a means for promoting social equity.</p>
<p><img alt="1938 Map of Atlanta uses colors as grades for neighborhoods. The red
swaths identify each area with large African-American populations that
were deemed “less safe.”" src="../../assets/redlining/redlining.png" />)</p>
<h2 id="understanding-redlining-as-a-systemic-disturbance">Understanding Redlining as a Systemic Disturbance<a class="headerlink" href="#understanding-redlining-as-a-systemic-disturbance" title="Permanent link">&para;</a></h2>
<p>Redlining originated in the 1930s as a discriminatory practice where the
Home Owners’ Loan Corporation (HOLC) systematically denied mortgages or
offered unfavorable terms based on racial and ethnic compositions. This
methodical exclusion, executed through maps that color-coded “risky”
investment areas in red, marked minority-populated areas, denying them
crucial investment and development opportunities and initiating a
profound and lasting disturbance in the urban fabric.</p>
<p>Maps serve as powerful tools beyond navigation; they communicate and
enforce control. By defining neighborhood boundaries through redlining,
HOLC maps not only mirrored societal biases but also perpetuated and
embedded them into the urban landscape. This manipulation of geographic
data set a trajectory that limited economic growth, dictated the
allocation of services, and influenced the development or deterioration
of community infrastructure.</p>
<p><strong>Figure 1:</strong> 1938 Map of Atlanta uses colors as grades for
neighborhoods. The red swaths identify each area with large
African-American populations that were deemed “less safe.”</p>
<p><a href="https://storymaps.arcgis.com/stories/0f58d49c566b486482b3e64e9e5f7ac9"><img alt="" src="../../assets/redlining/georectified-thumbnail.png" /></a></p>
<p>ArcGIS Story Map</p>
<p><strong>Explore the Story Map:</strong> Click on the image above to explore the
interactive story map about [subject of the story map].</p>
<h2 id="resilience-and-adaptation-in-urban-environments">Resilience and Adaptation in Urban Environments<a class="headerlink" href="#resilience-and-adaptation-in-urban-environments" title="Permanent link">&para;</a></h2>
<p>The legacy of redlining presents both a challenge and an opportunity for
resilience and adaptation. Economically and socially, redlining
entrenched cycles of poverty and racial segregation, creating a
resilient wealth gap that has been difficult to dismantle.
Environmentally, the neighborhoods targeted by redlining continue to
face significant challenges—they generally feature less greenspace,
suffer from higher pollution levels, and are more vulnerable to the
impacts of climate change. These factors compound the health and
wellness challenges faced by residents.</p>
<p>Despite these adversities, urban communities have continually
demonstrated remarkable resilience. Adaptation strategies, such as
community-led green initiatives, urban agriculture, and grassroots
activism, have emerged as responses to these systemic disturbances. By
enhancing green infrastructure and advocating for equitable
environmental policies, these communities strive to increase their
resilience against both historical inequities and environmental
challenges.</p>
<p><a href="https://youtu.be/O5FBJyqfoLM"><img alt="" src="https://img.youtube.com/vi/O5FBJyqfoLM/hqdefault.jpg" /></a></p>
<p>Watch the video</p>
<p><strong>Video Title:</strong> Exploring the Impacts of Historical Redlining on Urban
Development<br />
<strong>Description:</strong> Click on the image above to watch a video that delves
into the consequences of historical redlining and its ongoing impact on
urban environments. This educational piece offers insights into how such
discriminatory practices have shaped cities and what can be learned from
them.</p>
<p>The following group exercise will not only uncover the impact of
redlining on urban greenspace but also highlight the adaptive strategies
developed in response to this enduring disturbance. Through mapping and
analysis, we aim to illustrate the powerful role that geographic data
can play in understanding and fostering urban resilience and social
equity.</p>
<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<ul>
<li>Nardone, A., Rudolph, K. E., Morello-Frosch, R., &amp; Casey, J. A.
    (2021). Redlines and Greenspace: The Relationship between Historical
    Redlining and 2010 Greenspace across the United States.
    <em>Environmental Health Perspectives</em>, 129(1), 017006.
    DOI:10.1289/EHP7495.</li>
<li>Hoffman, J. S., Shandas, V., &amp; Pendleton, N. (2020). The Effects of
    Historical Housing Policies on Resident Exposure to Intra-Urban
    Heat: A Study of 108 US Urban Areas. <em>Climate</em>, 8(1), 12.
    DOI:10.3390/cli8010012.</li>
</ul>
<h2 id="goals-of-this-group-activity">Goals of this group activity<a class="headerlink" href="#goals-of-this-group-activity" title="Permanent link">&para;</a></h2>
<p>The primary objectives of this tutorial are: 1. To practice coding in
CyVerse. 2. To analyze the relationship between HOLC grades and the
presence of urban greenspace. 3. To understand how historic policies
continue to affect the spatial distribution of environmental amenities.</p>
<h2 id="part-1-accessing-and-visualizing-historic-redlining-data">Part 1: Accessing and Visualizing Historic Redlining Data<a class="headerlink" href="#part-1-accessing-and-visualizing-historic-redlining-data" title="Permanent link">&para;</a></h2>
<p>We will begin by accessing HOLC maps from the Mapping Inequality project
and overlaying this data with modern geographic datasets to visualize
the historical impact on contemporary urban landscapes.</p>
<h3 id="data-acquisition">Data Acquisition<a class="headerlink" href="#data-acquisition" title="Permanent link">&para;</a></h3>
<ul>
<li>Download HOLC map shapefiles from the University of Richmond’s
    Mapping Inequality Project.</li>
<li>Utilize satellite imagery and other geospatial data to map current
    greenspace using the normalized difference vegetation index (NDVI).</li>
</ul>
<h3 id="analysis-methodology">Analysis Methodology<a class="headerlink" href="#analysis-methodology" title="Permanent link">&para;</a></h3>
<ul>
<li>Replicate the approach used by Nardone et al. to calculate NDVI
    values for each HOLC neighborhood, assessing greenspace as a
    health-promoting resource.</li>
<li>Employ statistical methods such as propensity score matching to
    control for confounding variables and estimate the true impact of
    HOLC grades on urban greenspace.</li>
</ul>
<style>
img {
    width: 100%;
}

details summary {
  color: black;
  background-color: white;
}

details[open] summary {
  color: black; 
}
</style>
<details>
<summary>
R libraries we use in this analysis
</summary>

<div class="highlight"><pre><span></span><code><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;tidytext&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;tidytext&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidytext</span><span class="p">)</span>
<span class="c1">## Warning: package &#39;tidytext&#39; was built under R version 4.3.2</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>
<span class="c1">## Warning: package &#39;sf&#39; was built under R version 4.3.2</span>
<span class="c1">## Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="c1">## Warning: package &#39;ggplot2&#39; was built under R version 4.3.2</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span>
<span class="c1">## Warning: package &#39;ggthemes&#39; was built under R version 4.3.2</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="c1">## </span>
<span class="c1">## Attaching package: &#39;dplyr&#39;</span>
<span class="c1">## The following objects are masked from &#39;package:stats&#39;:</span>
<span class="c1">## </span>
<span class="c1">##     filter, lag</span>
<span class="c1">## The following objects are masked from &#39;package:base&#39;:</span>
<span class="c1">## </span>
<span class="c1">##     intersect, setdiff, setequal, union</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rstac</span><span class="p">)</span>
<span class="c1">## Warning: package &#39;rstac&#39; was built under R version 4.3.2</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gdalcubes</span><span class="p">)</span>
<span class="c1">## Warning: package &#39;gdalcubes&#39; was built under R version 4.3.2</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gdalUtils</span><span class="p">)</span>
<span class="c1">## Please note that rgdal will be retired during October 2023,</span>
<span class="c1">## plan transition to sf/stars/terra functions using GDAL and PROJ</span>
<span class="c1">## at your earliest convenience.</span>
<span class="c1">## See https://r-spatial.org/r/2023/05/15/evolution4.html and https://github.com/r-spatial/evolution</span>
<span class="c1">## rgdal: version: 1.6-7, (SVN revision 1203)</span>
<span class="c1">## Geospatial Data Abstraction Library extensions to R successfully loaded</span>
<span class="c1">## Loaded GDAL runtime: GDAL 3.5.3, released 2022/10/21</span>
<span class="c1">## Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/library/rgdal/gdal</span>
<span class="c1">##  GDAL does not use iconv for recoding strings.</span>
<span class="c1">## GDAL binary built with GEOS: TRUE </span>
<span class="c1">## Loaded PROJ runtime: Rel. 9.1.0, September 1st, 2022, [PJ_VERSION: 910]</span>
<span class="c1">## Path to PROJ shared files: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/library/gdalcubes/proj</span>
<span class="c1">## PROJ CDN enabled: FALSE</span>
<span class="c1">## Linking to sp version:1.6-1</span>
<span class="c1">## To mute warnings of possible GDAL/OSR exportToProj4() degradation,</span>
<span class="c1">## use options(&quot;rgdal_show_exportToProj4_warnings&quot;=&quot;none&quot;) before loading sp or rgdal.</span>
<span class="c1">## </span>
<span class="c1">## Attaching package: &#39;gdalUtils&#39;</span>
<span class="c1">## The following object is masked from &#39;package:sf&#39;:</span>
<span class="c1">## </span>
<span class="c1">##     gdal_rasterize</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gdalcubes</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">colorspace</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">terra</span><span class="p">)</span>
<span class="c1">## Warning: package &#39;terra&#39; was built under R version 4.3.2</span>
<span class="c1">## terra 1.7.71</span>
<span class="c1">## </span>
<span class="c1">## Attaching package: &#39;terra&#39;</span>
<span class="c1">## The following object is masked from &#39;package:colorspace&#39;:</span>
<span class="c1">## </span>
<span class="c1">##     RGB</span>
<span class="c1">## The following objects are masked from &#39;package:gdalcubes&#39;:</span>
<span class="c1">## </span>
<span class="c1">##     animate, crop, size</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyterra</span><span class="p">)</span>
<span class="c1">## </span>
<span class="c1">## Attaching package: &#39;tidyterra&#39;</span>
<span class="c1">## The following object is masked from &#39;package:stats&#39;:</span>
<span class="c1">## </span>
<span class="c1">##     filter</span>
<span class="nf">library</span><span class="p">(</span><span class="n">basemapR</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidytext</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggwordcloud</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">osmextract</span><span class="p">)</span>
<span class="c1">## Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright.</span>
<span class="c1">## Check the package website, https://docs.ropensci.org/osmextract/, for more details.</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span>
<span class="c1">## </span>
<span class="c1">## Attaching package: &#39;glue&#39;</span>
<span class="c1">## The following object is masked from &#39;package:terra&#39;:</span>
<span class="c1">## </span>
<span class="c1">##     trim</span>

<span class="nf">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span>
</code></pre></div>

</details>
<details>
<summary>
FUNCTION: List cities where HOLC data are available
</summary>

<div class="highlight"><pre><span></span><code><span class="c1"># Function to get a list of unique cities and states from the redlining data</span>
<span class="n">get_city_state_list_from_redlining_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># URL to the GeoJSON data</span>
<span class="w">  </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;https://raw.githubusercontent.com/americanpanorama/mapping-inequality-census-crosswalk/main/MIv3Areas_2010TractCrosswalk.geojson&quot;</span>

<span class="w">  </span><span class="c1"># Read the GeoJSON file into an sf object</span>
<span class="w">  </span><span class="n">redlining_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tryCatch</span><span class="p">({</span>
<span class="w">    </span><span class="nf">read_sf</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Error reading GeoJSON data: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">$</span><span class="n">message</span><span class="p">)</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="c1"># Check for the existence of &#39;city&#39; and &#39;state&#39; columns</span>
<span class="w">  </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;state&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">redlining_data</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;The required columns &#39;city&#39; and/or &#39;state&#39; do not exist in the data.&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1"># Extract a unique list of city and state pairs without the geometries</span>
<span class="w">  </span><span class="n">city_state_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">redlining_data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">st_set_geometry</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Drop the geometry to avoid issues with invalid shapes</span>
<span class="w">    </span><span class="nf">distinct</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">arrange</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="c1"># Arrange the list alphabetically by state, then by city</span>

<span class="w">  </span><span class="c1"># Return the dataframe of unique city-state pairs</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="n">city_state_df</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Stream list of available HOLC cities
</summary>

<div class="highlight"><pre><span></span><code><span class="c1">#Retrieve the list of cities and states</span>
<span class="n">city_state_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_city_state_list_from_redlining_data</span><span class="p">()</span>

<span class="n">knitr</span><span class="o">::</span><span class="nf">kable</span><span class="p">(</span><span class="n">city_state_list</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;markdown&quot;</span><span class="p">)</span>
</code></pre></div>

| city                             | state |
|:---------------------------------|:------|
| Birmingham                       | AL    |
| Mobile                           | AL    |
| Montgomery                       | AL    |
| Arkadelphia                      | AR    |
| Batesville                       | AR    |
| Camden                           | AR    |
| Conway                           | AR    |
| El Dorado                        | AR    |
| Fort Smith                       | AR    |
| Little Rock                      | AR    |
| Russellville                     | AR    |
| Texarkana                        | AR    |
| Phoenix                          | AZ    |
| Fresno                           | CA    |
| Los Angeles                      | CA    |
| Oakland                          | CA    |
| Sacramento                       | CA    |
| San Diego                        | CA    |
| San Francisco                    | CA    |
| San Jose                         | CA    |
| Stockton                         | CA    |
| Boulder                          | CO    |
| Colorado Springs                 | CO    |
| Denver                           | CO    |
| Fort Collins                     | CO    |
| Fort Morgan                      | CO    |
| Grand Junction                   | CO    |
| Greeley                          | CO    |
| Longmont                         | CO    |
| Pueblo                           | CO    |
| Bridgeport and Fairfield         | CT    |
| Hartford                         | CT    |
| New Britain                      | CT    |
| New Haven                        | CT    |
| Stamford, Darien, and New Canaan | CT    |
| Waterbury                        | CT    |
| Crestview                        | FL    |
| Daytona Beach                    | FL    |
| DeFuniak Springs                 | FL    |
| DeLand                           | FL    |
| Jacksonville                     | FL    |
| Miami                            | FL    |
| New Smyrna                       | FL    |
| Orlando                          | FL    |
| Pensacola                        | FL    |
| St. Petersburg                   | FL    |
| Tampa                            | FL    |
| Atlanta                          | GA    |
| Augusta                          | GA    |
| Columbus                         | GA    |
| Macon                            | GA    |
| Savannah                         | GA    |
| Boone                            | IA    |
| Cedar Rapids                     | IA    |
| Council Bluffs                   | IA    |
| Davenport                        | IA    |
| Des Moines                       | IA    |
| Dubuque                          | IA    |
| Sioux City                       | IA    |
| Waterloo                         | IA    |
| Aurora                           | IL    |
| Chicago                          | IL    |
| Decatur                          | IL    |
| East St. Louis                   | IL    |
| Joliet                           | IL    |
| Peoria                           | IL    |
| Rockford                         | IL    |
| Springfield                      | IL    |
| Evansville                       | IN    |
| Fort Wayne                       | IN    |
| Indianapolis                     | IN    |
| Lake Co. Gary                    | IN    |
| Muncie                           | IN    |
| South Bend                       | IN    |
| Terre Haute                      | IN    |
| Atchison                         | KS    |
| Junction City                    | KS    |
| Topeka                           | KS    |
| Wichita                          | KS    |
| Covington                        | KY    |
| Lexington                        | KY    |
| Louisville                       | KY    |
| New Orleans                      | LA    |
| Shreveport                       | LA    |
| Arlington                        | MA    |
| Belmont                          | MA    |
| Boston                           | MA    |
| Braintree                        | MA    |
| Brockton                         | MA    |
| Brookline                        | MA    |
| Cambridge                        | MA    |
| Chelsea                          | MA    |
| Dedham                           | MA    |
| Everett                          | MA    |
| Fall River                       | MA    |
| Fitchburg                        | MA    |
| Haverhill                        | MA    |
| Holyoke Chicopee                 | MA    |
| Lawrence                         | MA    |
| Lexington                        | MA    |
| Lowell                           | MA    |
| Lynn                             | MA    |
| Malden                           | MA    |
| Medford                          | MA    |
| Melrose                          | MA    |
| Milton                           | MA    |
| Needham                          | MA    |
| New Bedford                      | MA    |
| Newton                           | MA    |
| Pittsfield                       | MA    |
| Quincy                           | MA    |
| Revere                           | MA    |
| Salem                            | MA    |
| Saugus                           | MA    |
| Somerville                       | MA    |
| Springfield                      | MA    |
| Waltham                          | MA    |
| Watertown                        | MA    |
| Winchester                       | MA    |
| Winthrop                         | MA    |
| Worcester                        | MA    |
| Baltimore                        | MD    |
| Augusta                          | ME    |
| Boothbay                         | ME    |
| Portland                         | ME    |
| Sanford                          | ME    |
| Waterville                       | ME    |
| Battle Creek                     | MI    |
| Bay City                         | MI    |
| Detroit                          | MI    |
| Flint                            | MI    |
| Grand Rapids                     | MI    |
| Jackson                          | MI    |
| Kalamazoo                        | MI    |
| Lansing                          | MI    |
| Muskegon                         | MI    |
| Pontiac                          | MI    |
| Saginaw                          | MI    |
| Austin                           | MN    |
| Duluth                           | MN    |
| Mankato                          | MN    |
| Minneapolis                      | MN    |
| Rochester                        | MN    |
| St. Cloud                        | MN    |
| St. Paul                         | MN    |
| Staples                          | MN    |
| Cape Girardeau                   | MO    |
| Carthage                         | MO    |
| Greater Kansas City              | MO    |
| Joplin                           | MO    |
| Springfield                      | MO    |
| St. Joseph                       | MO    |
| St. Louis                        | MO    |
| Jackson                          | MS    |
| Asheville                        | NC    |
| Charlotte                        | NC    |
| Durham                           | NC    |
| Elizabeth City                   | NC    |
| Fayetteville                     | NC    |
| Goldsboro                        | NC    |
| Greensboro                       | NC    |
| Hendersonville                   | NC    |
| High Point                       | NC    |
| New Bern                         | NC    |
| Rocky Mount                      | NC    |
| Statesville                      | NC    |
| Winston-Salem                    | NC    |
| Fargo                            | ND    |
| Grand Forks                      | ND    |
| Minot                            | ND    |
| Williston                        | ND    |
| Lincoln                          | NE    |
| Omaha                            | NE    |
| Manchester                       | NH    |
| Atlantic City                    | NJ    |
| Bergen Co.                       | NJ    |
| Camden                           | NJ    |
| Essex Co.                        | NJ    |
| Hudson Co.                       | NJ    |
| Monmouth                         | NJ    |
| Passaic County                   | NJ    |
| Perth Amboy                      | NJ    |
| Trenton                          | NJ    |
| Union Co.                        | NJ    |
| Albany                           | NY    |
| Binghamton-Johnson City          | NY    |
| Bronx                            | NY    |
| Brooklyn                         | NY    |
| Buffalo                          | NY    |
| Elmira                           | NY    |
| Jamestown                        | NY    |
| Lower Westchester Co.            | NY    |
| Manhattan                        | NY    |
| Niagara Falls                    | NY    |
| Poughkeepsie                     | NY    |
| Queens                           | NY    |
| Rochester                        | NY    |
| Schenectady                      | NY    |
| Staten Island                    | NY    |
| Syracuse                         | NY    |
| Troy                             | NY    |
| Utica                            | NY    |
| Akron                            | OH    |
| Canton                           | OH    |
| Cleveland                        | OH    |
| Columbus                         | OH    |
| Dayton                           | OH    |
| Hamilton                         | OH    |
| Lima                             | OH    |
| Lorain                           | OH    |
| Portsmouth                       | OH    |
| Springfield                      | OH    |
| Toledo                           | OH    |
| Warren                           | OH    |
| Youngstown                       | OH    |
| Ada                              | OK    |
| Alva                             | OK    |
| Enid                             | OK    |
| Miami Ottawa County              | OK    |
| Muskogee                         | OK    |
| Norman                           | OK    |
| Oklahoma City                    | OK    |
| South McAlester                  | OK    |
| Tulsa                            | OK    |
| Portland                         | OR    |
| Allentown                        | PA    |
| Altoona                          | PA    |
| Bethlehem                        | PA    |
| Chester                          | PA    |
| Erie                             | PA    |
| Harrisburg                       | PA    |
| Johnstown                        | PA    |
| Lancaster                        | PA    |
| McKeesport                       | PA    |
| New Castle                       | PA    |
| Philadelphia                     | PA    |
| Pittsburgh                       | PA    |
| Wilkes-Barre                     | PA    |
| York                             | PA    |
| Pawtucket & Central Falls        | RI    |
| Providence                       | RI    |
| Woonsocket                       | RI    |
| Aiken                            | SC    |
| Charleston                       | SC    |
| Columbia                         | SC    |
| Greater Anderson                 | SC    |
| Greater Greenville               | SC    |
| Orangeburg                       | SC    |
| Rock Hill                        | SC    |
| Spartanburg                      | SC    |
| Sumter                           | SC    |
| Aberdeen                         | SD    |
| Huron                            | SD    |
| Milbank                          | SD    |
| Mitchell                         | SD    |
| Rapid City                       | SD    |
| Sioux Falls                      | SD    |
| Vermillion                       | SD    |
| Watertown                        | SD    |
| Chattanooga                      | TN    |
| Elizabethton                     | TN    |
| Erwin                            | TN    |
| Greenville                       | TN    |
| Johnson City                     | TN    |
| Knoxville                        | TN    |
| Memphis                          | TN    |
| Nashville                        | TN    |
| Amarillo                         | TX    |
| Austin                           | TX    |
| Beaumont                         | TX    |
| Dallas                           | TX    |
| El Paso                          | TX    |
| Fort Worth                       | TX    |
| Galveston                        | TX    |
| Houston                          | TX    |
| Port Arthur                      | TX    |
| San Antonio                      | TX    |
| Waco                             | TX    |
| Wichita Falls                    | TX    |
| Ogden                            | UT    |
| Salt Lake City                   | UT    |
| Bristol                          | VA    |
| Danville                         | VA    |
| Harrisonburg                     | VA    |
| Lynchburg                        | VA    |
| Newport News                     | VA    |
| Norfolk                          | VA    |
| Petersburg                       | VA    |
| Phoebus                          | VA    |
| Richmond                         | VA    |
| Roanoke                          | VA    |
| Staunton                         | VA    |
| Bennington                       | VT    |
| Brattleboro                      | VT    |
| Burlington                       | VT    |
| Montpelier                       | VT    |
| Newport City                     | VT    |
| Poultney                         | VT    |
| Rutland                          | VT    |
| Springfield                      | VT    |
| St. Albans                       | VT    |
| St. Johnsbury                    | VT    |
| Windsor                          | VT    |
| Seattle                          | WA    |
| Spokane                          | WA    |
| Tacoma                           | WA    |
| Kenosha                          | WI    |
| Madison                          | WI    |
| Milwaukee Co.                    | WI    |
| Oshkosh                          | WI    |
| Racine                           | WI    |
| Charleston                       | WV    |
| Huntington                       | WV    |
| Wheeling                         | WV    |

</details>
<details>
<summary>
FUNCTION: Stream HOLC data from a city
</summary>

<div class="highlight"><pre><span></span><code><span class="c1"># Function to load and filter redlining data by city</span>
<span class="n">load_city_redlining_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">city_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># URL to the GeoJSON data</span>
<span class="w">  </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;https://raw.githubusercontent.com/americanpanorama/mapping-inequality-census-crosswalk/main/MIv3Areas_2010TractCrosswalk.geojson&quot;</span>

<span class="w">  </span><span class="c1"># Read the GeoJSON file into an sf object</span>
<span class="w">  </span><span class="n">redlining_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_sf</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Filter the data for the specified city and non-empty grades</span>

<span class="w">  </span><span class="n">city_redline</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">redlining_data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">city</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">city_name</span><span class="w"> </span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Return the filtered data</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="n">city_redline</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Stream HOLC data for Denver, CO
</summary>

<div class="highlight"><pre><span></span><code><span class="c1"># Load redlining data for Denver</span>
<span class="n">denver_redlining</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">load_city_redlining_data</span><span class="p">(</span><span class="s">&quot;Denver&quot;</span><span class="p">)</span>
<span class="n">knitr</span><span class="o">::</span><span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">),</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;markdown&quot;</span><span class="p">)</span>
</code></pre></div>

| area_id | city   | state | city_survey | cat  | grade | label | res  | com   | ind   | fill     | GEOID10     | GISJOIN        |    calc_area | pct_tract | geometry                     |
|--------:|:-------|:------|:------------|:-----|:------|:------|:-----|:------|:------|:---------|:------------|:---------------|-------------:|----------:|:-----------------------------|
|    6525 | Denver | CO    | TRUE        | Best | A     | A1    | TRUE | FALSE | FALSE | \#76a865 | 08031004104 | G0800310004104 | 1.525535e+01 |   0.00001 | MULTIPOLYGON (((-104.9125 3… |
|    6525 | Denver | CO    | TRUE        | Best | A     | A1    | TRUE | FALSE | FALSE | \#76a865 | 08031004201 | G0800310004201 | 3.987458e+05 |   0.20900 | MULTIPOLYGON (((-104.9246 3… |
|    6525 | Denver | CO    | TRUE        | Best | A     | A1    | TRUE | FALSE | FALSE | \#76a865 | 08031004304 | G0800310004304 | 1.554195e+05 |   0.05927 | MULTIPOLYGON (((-104.9125 3… |
|    6525 | Denver | CO    | TRUE        | Best | A     | A1    | TRUE | FALSE | FALSE | \#76a865 | 08031004202 | G0800310004202 | 1.117770e+06 |   0.57245 | MULTIPOLYGON (((-104.9125 3… |
|    6529 | Denver | CO    | TRUE        | Best | A     | A2    | TRUE | FALSE | FALSE | \#76a865 | 08031004302 | G0800310004302 | 3.133415e+05 |   0.28381 | MULTIPOLYGON (((-104.928 39… |
|    6529 | Denver | CO    | TRUE        | Best | A     | A2    | TRUE | FALSE | FALSE | \#76a865 | 08031004301 | G0800310004301 | 1.221218e+05 |   0.08622 | MULTIPOLYGON (((-104.9305 3… |

</details>
<details>
<summary>
FUNCTION: Get Points-of-Interest from city of interest
</summary>

<div class="highlight"><pre><span></span><code><span class="n">get_places</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;food&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Check if the input is an sf object</span>
<span class="w">  </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">inherits</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sf&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;The provided object is not an sf object.&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1"># Create a bounding box from the input sf object</span>
<span class="w">  </span><span class="n">bbox_here</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_bbox</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">st_as_sfc</span><span class="p">()</span>

<span class="w">  </span><span class="nf">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;food&quot;</span><span class="p">){</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;multipolygons&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM multipolygons WHERE (</span>
<span class="s">                 shop IN (&#39;supermarket&#39;, &#39;bodega&#39;, &#39;market&#39;, &#39;other_market&#39;, &#39;farm&#39;, &#39;garden_centre&#39;, &#39;doityourself&#39;, &#39;farm_supply&#39;, &#39;compost&#39;, &#39;mulch&#39;, &#39;fertilizer&#39;) OR</span>
<span class="s">                 amenity IN (&#39;social_facility&#39;, &#39;market&#39;, &#39;restaurant&#39;, &#39;coffee&#39;) OR</span>
<span class="s">                 leisure = &#39;garden&#39; OR</span>
<span class="s">                 landuse IN (&#39;farm&#39;, &#39;farmland&#39;, &#39;row_crops&#39;, &#39;orchard_plantation&#39;, &#39;dairy_grazing&#39;) OR</span>
<span class="s">                 building IN (&#39;brewery&#39;, &#39;winery&#39;, &#39;distillery&#39;) OR</span>
<span class="s">                 shop = &#39;greengrocer&#39; OR</span>
<span class="s">                 amenity = &#39;marketplace&#39;</span>
<span class="s">               )&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;food&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nf">if </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;processed_food&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;multipolygons&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM multipolygons WHERE (</span>
<span class="s">                   amenity IN (&#39;fast_food&#39;, &#39;cafe&#39;, &#39;pub&#39;) OR</span>
<span class="s">                   shop IN (&#39;convenience&#39;, &#39;supermarket&#39;) OR</span>
<span class="s">                   shop = &#39;kiosk&#39;</span>
<span class="s">                 )&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Processed Food Locations&quot;</span>
<span class="p">}</span>

<span class="w">  </span><span class="nf">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;natural_habitats&quot;</span><span class="p">){</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;multipolygons&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM multipolygons WHERE (</span>
<span class="s">             boundary = &#39;protected_area&#39; OR</span>
<span class="s">             natural IN (&#39;tree&#39;, &#39;wood&#39;) OR</span>
<span class="s">             landuse = &#39;forest&#39; OR</span>
<span class="s">             leisure = &#39;park&#39;</span>
<span class="s">           )&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Natural habitats or City owned trees&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">   </span><span class="nf">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;roads&quot;</span><span class="p">){</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;lines&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM lines WHERE (</span>
<span class="s">             highway IN (&#39;motorway&#39;, &#39;trunk&#39;, &#39;primary&#39;, &#39;secondary&#39;, &#39;tertiary&#39;) )&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Major roads&quot;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">  </span><span class="nf">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;rivers&quot;</span><span class="p">){</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;lines&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM lines WHERE (</span>
<span class="s">             waterway IN (&#39;river&#39;))&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Major rivers&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nf">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;internet_access&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;multipolygons&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM multipolygons WHERE (</span>
<span class="s">                 amenity IN (&#39;library&#39;, &#39;cafe&#39;, &#39;community_centre&#39;, &#39;public_building&#39;) AND</span>
<span class="s">                 internet_access = &#39;yes&#39; </span>
<span class="s">               )&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Internet Access Locations&quot;</span>
<span class="p">}</span>

<span class="w">  </span><span class="nf">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;water_bodies&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;multipolygons&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM multipolygons WHERE (</span>
<span class="s">                 natural IN (&#39;water&#39;, &#39;lake&#39;, &#39;pond&#39;) OR</span>
<span class="s">                 water IN (&#39;lake&#39;, &#39;pond&#39;) OR</span>
<span class="s">                 landuse = &#39;reservoir&#39;</span>
<span class="s">               )&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Water Bodies&quot;</span>
<span class="p">}</span>

<span class="w"> </span><span class="nf">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;government_buildings&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">my_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;multipolygons&quot;</span>
<span class="w">    </span><span class="n">my_query</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;SELECT * FROM multipolygons WHERE (</span>
<span class="s">                 amenity IN (&#39;townhall&#39;, &#39;courthouse&#39;, &#39;embassy&#39;, &#39;police&#39;, &#39;fire_station&#39;) OR</span>
<span class="s">                 building IN (&#39;capitol&#39;, &#39;government&#39;)</span>
<span class="s">               )&quot;</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Government Buildings&quot;</span>
<span class="p">}</span>



<span class="w">  </span><span class="c1"># Use the bbox to get data with oe_get(), specifying the desired layer and a custom SQL query for fresh food places</span>
<span class="w">  </span><span class="nf">tryCatch</span><span class="p">({</span>
<span class="w">    </span><span class="n">places</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">oe_get</span><span class="p">(</span>
<span class="w">      </span><span class="n">place</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_here</span><span class="p">,</span>
<span class="w">      </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_layer</span><span class="p">,</span><span class="w">  </span><span class="c1"># Adjusted layer; change as per actual data availability</span>
<span class="w">      </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_query</span><span class="p">,</span>
<span class="w">      </span><span class="n">quiet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">  </span><span class="n">places</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_make_valid</span><span class="p">(</span><span class="n">places</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Crop the data to the bounding box</span>
<span class="w">    </span><span class="n">cropped_places</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_crop</span><span class="p">(</span><span class="n">places</span><span class="p">,</span><span class="w"> </span><span class="n">bbox_here</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Plotting the cropped fresh food places</span>
<span class="w">    </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cropped_places</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;cornflowerblue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;cornflowerblue&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nf">ggtitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_tufte</span><span class="p">()</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1"># Optionally hide the legend</span>
<span class="w">        </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">     </span><span class="c1"># Remove axis text</span>
<span class="w">        </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">    </span><span class="c1"># Remove axis titles</span>
<span class="w">        </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">    </span><span class="c1"># Remove axis ticks</span>
<span class="w">         </span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w">  </span><span class="c1"># Set the plot background to white</span>
<span class="w">        </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w">  </span><span class="c1"># Set the panel background to white</span>
<span class="w">        </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">  </span><span class="c1"># Remove major grid lines</span>
<span class="w">        </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span>

<span class="w">    </span><span class="c1"># Save the plot as a PNG file</span>
<span class="w">    </span><span class="n">png_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">Sys.Date</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">ggsave</span><span class="p">(</span><span class="n">png_filename</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Return the cropped dataset</span>
<span class="w">    </span><span class="nf">return</span><span class="p">(</span><span class="n">cropped_places</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Failed to retrieve or plot data: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">$</span><span class="n">message</span><span class="p">)</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
FUNCTION: Plot POI over HOLC grades
</summary>

<div class="highlight"><pre><span></span><code><span class="n">plot_city_redlining</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">redlining_data</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;redlining_plot.png&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Fetch additional geographic data based on redlining data</span>
<span class="w">  </span><span class="n">roads</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">redlining_data</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;roads&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">rivers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">redlining_data</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rivers&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Filter residential zones with valid grades and where city survey is TRUE</span>
<span class="w">  </span><span class="n">residential_zones</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">redlining_data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">city_survey</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">grade</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span>

<span class="w">  </span><span class="c1"># Colors for the grades</span>
<span class="w">  </span><span class="n">colors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#76a865&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;#7cb5bd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;#ffff00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;#d9838d&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Plot the data using ggplot2</span>
<span class="w">  </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rivers</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residential_zones</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grade</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_tufte</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colors</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;HOLC Categories&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">      </span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">      </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">      </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">      </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">      </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;right&quot;</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Save the plot as a high-resolution PNG file</span>
<span class="w">  </span><span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Return the plot object if needed for further manipulation or checking</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Plot Denver Redlining
</summary>

<div class="highlight"><pre><span></span><code><span class="n">denver_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">plot_city_redlining</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../redlining_plot.png" /></p>
<details>
<summary>
Stream amenities by category
</summary>

<div class="highlight"><pre><span></span><code><span class="n">food</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;food&quot;</span><span class="p">)</span>

<span class="n">food_processed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;processed_food&quot;</span><span class="p">)</span>

<span class="n">natural_habitats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;natural_habitats&quot;</span><span class="p">)</span>

<span class="n">roads</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;roads&quot;</span><span class="p">)</span>

<span class="n">rivers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;rivers&quot;</span><span class="p">)</span>

<span class="c1">#water_bodies &lt;- get_places(denver_redlining, type=&quot;water_bodies&quot;)</span>

<span class="n">government_buildings</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_places</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;government_buildings&quot;</span><span class="p">)</span>
</code></pre></div>

</details>
<details>
<summary>
FUNCTION: Plot the HOLC grades individually
</summary>

<div class="highlight"><pre><span></span><code><span class="n">split_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">sf_data</span><span class="p">,</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">rivers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Filter for grades A, B, C, and D</span>
<span class="w">  </span><span class="n">sf_data_filtered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sf_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">grade</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;D&#39;</span><span class="p">))</span>

<span class="w">  </span><span class="c1"># Define a color for each grade</span>
<span class="w">  </span><span class="n">grade_colors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;#76a865&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;#7cb5bd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;#ffff00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;D&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;#d9838d&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Create the plot with panels for each grade</span>
<span class="w">  </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sf_data_filtered</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rivers</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grade</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Free scales for different zoom levels if needed</span>
<span class="w">    </span><span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grade_colors</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;HOLC Grade&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_tufte</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1"># Optionally hide the legend</span>
<span class="w">          </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">     </span><span class="c1"># Remove axis text</span>
<span class="w">          </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">    </span><span class="c1"># Remove axis titles</span>
<span class="w">          </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">    </span><span class="c1"># Remove axis ticks</span>
<span class="w">          </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span><span class="w">  </span><span class="c1"># Remove major grid lines</span>
<span class="w">          </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">())</span><span class="w">  </span>

<span class="w">  </span><span class="nf">ggsave</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HOLC_grades_individually.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1200</span><span class="p">)</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Plot 4 HOLC grades individually
</summary>

<div class="highlight"><pre><span></span><code><span class="n">plot_row</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">split_plot</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">rivers</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../HOLC_grades_individually.png" /></p>
<details>
<summary>
FUNCTION: Map an amenity over each grade individually
</summary>

<div class="highlight"><pre><span></span><code><span class="n">process_and_plot_sf_layers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">layer1</span><span class="p">,</span><span class="w"> </span><span class="n">layer2</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;output_plot.png&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1"># Make geometries valid</span>
<span class="n">layer1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_make_valid</span><span class="p">(</span><span class="n">layer1</span><span class="p">)</span>
<span class="n">layer2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_make_valid</span><span class="p">(</span><span class="n">layer2</span><span class="p">)</span>

<span class="c1"># Optionally, simplify geometries to remove duplicate vertices</span>
<span class="n">layer1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_simplify</span><span class="p">(</span><span class="n">layer1</span><span class="p">,</span><span class="w"> </span><span class="n">preserveTopology</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">grade</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Prepare a list to store results</span>
<span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span>

<span class="c1"># Loop through each grade and perform operations</span>
<span class="nf">for </span><span class="p">(</span><span class="n">grade</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;D&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Filter layer1 for current grade</span>
<span class="w">  </span><span class="n">layer1_grade</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">layer1</span><span class="p">[</span><span class="n">layer1</span><span class="o">$</span><span class="n">grade</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>

<span class="w">  </span><span class="c1"># Buffer the geometries of the current grade</span>
<span class="w">  </span><span class="n">buffered_layer1_grade</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_buffer</span><span class="p">(</span><span class="n">layer1_grade</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Intersect with the second layer</span>
<span class="w">  </span><span class="n">intersections</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_intersects</span><span class="p">(</span><span class="n">layer2</span><span class="p">,</span><span class="w"> </span><span class="n">buffered_layer1_grade</span><span class="p">,</span><span class="w"> </span><span class="n">sparse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="w">  </span><span class="n">selected_polygons</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">layer2</span><span class="p">[</span><span class="nf">rowSums</span><span class="p">(</span><span class="n">intersections</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>

<span class="w">  </span><span class="c1"># Add a new column to store the grade information</span>
<span class="w">  </span><span class="n">selected_polygons</span><span class="o">$</span><span class="n">grade</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grade</span>

<span class="w">  </span><span class="c1"># Store the result</span>
<span class="w">  </span><span class="n">results</span><span class="p">[[</span><span class="n">grade</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">selected_polygons</span>
<span class="p">}</span>

<span class="c1"># Combine all selected polygons from different grades into one sf object</span>
<span class="n">final_selected_polygons</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Define colors for the grades</span>
<span class="w">  </span><span class="n">grade_colors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;D&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Create the plot</span>
<span class="w">  </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rivers</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">layer1</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">final_selected_polygons</span><span class="p">,</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="c1">#scale_fill_manual(values = grade_colors) +</span>
<span class="w">    </span><span class="c1">#scale_color_manual(values = grade_colors) +</span>
<span class="w">    </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;HOLC Grade&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_tufte</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">      </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">      </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">())</span>

<span class="w">  </span><span class="c1"># Save the plot as a high-resolution PNG file</span>
<span class="w">  </span><span class="nf">ggsave</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1200</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Return the plot for optional further use</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">sf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">final_selected_polygons</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
FUNCTION: Create word cloud per grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">create_wordclouds_by_grade</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">sf_object</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;food_word_cloud_per_grade.png&quot;</span><span class="p">,</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Healthy food place names word cloud&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_size</span><span class="w"> </span><span class="o">=</span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">col_select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>


<span class="w">    </span><span class="c1"># Extract relevant data and prepare text data</span>
<span class="w">    </span><span class="n">text_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sf_object</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">select</span><span class="p">(</span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">col_select</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">col_select</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">unnest_tokens</span><span class="p">(</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;word&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_select</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;words&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">count</span><span class="p">(</span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">        </span><span class="nf">filter</span><span class="p">(</span><span class="nf">n</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># Filter to remove overly common or single-occurrence words</span>

<span class="w">    </span><span class="c1"># Ensure there are no NA values in the &#39;word&#39; column</span>
<span class="w">    </span><span class="n">text_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">text_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>

<span class="w">    </span><span class="c1"># Handle cases where text_data might be empty</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">text_data</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;No data available for creating word clouds.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Create a word cloud using ggplot2 and ggwordcloud</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_text_wordcloud_area</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">text_data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="n">rm_outside</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">scale_size_area</span><span class="p">(</span><span class="n">max_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_size</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nf">scale_color_gradient</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;darkred&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">panel.spacing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lines&quot;</span><span class="p">),</span>
<span class="w">              </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">              </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">title</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Attempt to save the plot and handle any errors</span>
<span class="w">    </span><span class="nf">tryCatch</span><span class="p">({</span>
<span class="w">        </span><span class="nf">ggsave</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">)</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Error in saving the plot: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">$</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nf">return</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Map food over each grade individually
</summary>

<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">layer1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">denver_redlining</span>
<span class="w"> </span><span class="n">layer2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">food</span>
<span class="w"> </span><span class="n">food_match</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_and_plot_sf_layers</span><span class="p">(</span><span class="n">layer1</span><span class="p">,</span><span class="w"> </span><span class="n">layer2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;food_match.png&quot;</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../food_match.png" /></p>
<details>
<summary>
WORD CLOUD: Names of places with fresh food
</summary>

<div class="highlight"><pre><span></span><code><span class="n">food_word_cloud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">create_wordclouds_by_grade</span><span class="p">(</span><span class="n">food_match</span><span class="o">$</span><span class="n">sf</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;food_word_cloud_per_grade.png&quot;</span><span class="p">)</span>
</code></pre></div>

    Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
    ℹ Please use `all_of()` or `any_of()` instead.
      # Was:
      data %>% select(col_select)

      # Now:
      data %>% select(all_of(col_select))

    See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.

    Warning in wordcloud_boxes(data_points = points_valid_first, boxes = boxes, :
    Some words could not fit on page. They have been removed.

</details>

<p><img alt="" src="../food_word_cloud_per_grade.png" /></p>
<details>
<summary>
Map processed food over each grade individually
</summary>

<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">layer1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">denver_redlining</span>
<span class="w"> </span><span class="n">layer2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">food_processed</span>
<span class="w"> </span><span class="n">processed_food_match</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_and_plot_sf_layers</span><span class="p">(</span><span class="n">layer1</span><span class="p">,</span><span class="w"> </span><span class="n">layer2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;processed_food_match.png&quot;</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../processed_food_match.png" /></p>
<details>
<summary>
WORD CLOUD: Names of places with processed food
</summary>

<div class="highlight"><pre><span></span><code><span class="n">processed_food_cloud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">create_wordclouds_by_grade</span><span class="p">(</span><span class="n">processed_food_match</span><span class="o">$</span><span class="n">sf</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;processed_food_word_cloud_per_grade.png&quot;</span><span class="p">,</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Processed food place names where larger text is more frequent&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_size</span><span class="w"> </span><span class="o">=</span><span class="m">17</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../processed_food_word_cloud_per_grade.png" /></p>
<h2 id="part-2-integrating-environmental-data">Part 2: Integrating Environmental Data<a class="headerlink" href="#part-2-integrating-environmental-data" title="Permanent link">&para;</a></h2>
<h3 id="data-processing">Data Processing<a class="headerlink" href="#data-processing" title="Permanent link">&para;</a></h3>
<ul>
<li>Use satellite data from 2010 to analyze greenspace using NDVI, an
    index that measures the quantity of vegetation in an area.</li>
<li>Apply methods to adjust for potential confounders as described in
    the study, ensuring that comparisons of greenspace across HOLC
    grades are valid and not biased by historical or socio-demographic
    factors.</li>
</ul>
<details>
<summary>
Map natural habitats over each grade individually
</summary>

<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">layer1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">denver_redlining</span>
<span class="w"> </span><span class="n">layer2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">natural_habitats</span>
<span class="w"> </span><span class="n">natural_habitats_match</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_and_plot_sf_layers</span><span class="p">(</span><span class="n">layer1</span><span class="p">,</span><span class="w"> </span><span class="n">layer2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;natural_habitats_match.png&quot;</span><span class="p">)</span>
<span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="n">natural_habitats_match</span><span class="o">$</span><span class="n">plot</span><span class="p">)</span>
</code></pre></div>

![](worksheet_redlining_files/figure-gfm/unnamed-chunk-18-1.png)

</details>

<p><img alt="" src="../natural_habitats_match.png" /></p>
<details>
<summary>
WORD CLOUD: Name of natural habitat area
</summary>

<div class="highlight"><pre><span></span><code><span class="n">natural_habitats_cloud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">create_wordclouds_by_grade</span><span class="p">(</span><span class="n">natural_habitats_match</span><span class="o">$</span><span class="n">sf</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;natural_habitats_word_cloud_per_grade.png&quot;</span><span class="p">,</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Natural habitats place names where larger text is more frequent&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_size</span><span class="w"> </span><span class="o">=</span><span class="m">35</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../natural_habitats_word_cloud_per_grade.png" /></p>
<details>
<summary>
FUNCTION: Stream NDVI data
</summary>

<div class="highlight"><pre><span></span><code><span class="n">polygon_layer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">denver_redlining</span>
<span class="c1"># Function to process satellite data based on an SF polygon&#39;s extent</span>
<span class="n">process_satellite_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">,</span><span class="w"> </span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="p">,</span><span class="w"> </span><span class="n">assets</span><span class="p">,</span><span class="w"> </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;anim.gif&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Record start time</span>
<span class="w">  </span><span class="n">start_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Calculate the bbox from the polygon layer</span>
<span class="w">  </span><span class="n">bbox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_bbox</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">)</span>

<span class="w">  </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stac</span><span class="p">(</span><span class="s">&quot;https://earth-search.aws.element84.com/v0&quot;</span><span class="p">)</span>


<span class="w">  </span><span class="c1"># Use stacR to search for Sentinel-2 images within the bbox and date range</span>
<span class="w">  </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">stac_search</span><span class="p">(</span>
<span class="w">    </span><span class="n">collections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sentinel-s2-l2a-cogs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmax&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymax&quot;</span><span class="p">]),</span>
<span class="w">    </span><span class="n">datetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">post_request</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Define mask for Sentinel-2 image quality</span>
<span class="w">  </span><span class="c1">#S2.mask &lt;- image_mask(&quot;SCL&quot;, values = c(3, 8, 9))</span>

<span class="w">  </span><span class="c1"># Create a collection of images filtering by cloud cover</span>
<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">stac_image_collection</span><span class="p">(</span><span class="n">items</span><span class="o">$</span><span class="n">features</span><span class="p">,</span><span class="w"> </span><span class="n">asset_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assets</span><span class="p">,</span><span class="w"> </span><span class="n">property_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;eo:cloud_cover&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">30</span><span class="p">})</span>

<span class="w">  </span><span class="c1"># Define a view for processing the data</span>
<span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cube_view</span><span class="p">(</span><span class="n">srs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EPSG:4326&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end_date</span><span class="p">,</span>
<span class="w">                               </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmax&quot;</span><span class="p">],</span><span class="w"> </span>
<span class="w">                               </span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymax&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymin&quot;</span><span class="p">]),</span>
<span class="w">                 </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.001</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.001</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;P1M&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">aggregation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;median&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">resampling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bilinear&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Calculate NDVI and create an animation</span>
<span class="w">  </span><span class="n">ndvi_col</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">rev</span><span class="p">(</span><span class="nf">sequential_hcl</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Green-Yellow&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">#raster_cube(col, v, mask = S2.mask) %&gt;%</span>
<span class="w">  </span><span class="nf">raster_cube</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">select_bands</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">apply_pixel</span><span class="p">(</span><span class="s">&quot;(B08-B04)/(B08+B04)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NDVI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="n">gdalcubes</span><span class="o">::</span><span class="nf">animate</span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndvi_col</span><span class="p">,</span><span class="w"> </span><span class="n">zlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-0.2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">key.pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">save_as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output_file</span><span class="p">,</span><span class="w"> </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fps</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Calculate processing time</span>
<span class="w">  </span><span class="n">end_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="w">  </span><span class="n">processing_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">difftime</span><span class="p">(</span><span class="n">end_time</span><span class="p">,</span><span class="w"> </span><span class="n">start_time</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Return processing time</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="n">processing_time</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Stream NDVI data: animation
</summary>

<div class="highlight"><pre><span></span><code><span class="n">processing_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_satellite_data</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2022-05-31&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2023-05-31&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">))</span>
</code></pre></div>

</details>

<p><img alt="" src="../anim.gif" /></p>
<details>
<summary>
FUNCTION: Stream year average NDVI
</summary>

<div class="highlight"><pre><span></span><code><span class="n">yearly_average_ndvi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ndvi.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Record start time</span>
<span class="w">  </span><span class="n">start_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Calculate the bbox from the polygon layer</span>
<span class="w">  </span><span class="n">bbox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_bbox</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">)</span>

<span class="w">  </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stac</span><span class="p">(</span><span class="s">&quot;https://earth-search.aws.element84.com/v0&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Search for Sentinel-2 images within the bbox for June</span>
<span class="w">  </span><span class="n">items</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">stac_search</span><span class="p">(</span>
<span class="w">    </span><span class="n">collections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sentinel-s2-l2a-cogs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmax&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymax&quot;</span><span class="p">]),</span>
<span class="w">    </span><span class="n">datetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2023-01-01/2023-12-31&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">post_request</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Create a collection of images filtering by cloud cover</span>
<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">stac_image_collection</span><span class="p">(</span><span class="n">items</span><span class="o">$</span><span class="n">features</span><span class="p">,</span><span class="w"> </span><span class="n">asset_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">property_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;eo:cloud_cover&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">80</span><span class="p">})</span>

<span class="w">  </span><span class="c1"># Define a view for processing the data specifically for June</span>
<span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cube_view</span><span class="p">(</span><span class="n">srs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EPSG:4326&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2023-01-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2023-12-31&quot;</span><span class="p">,</span>
<span class="w">                               </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmax&quot;</span><span class="p">],</span><span class="w"> </span>
<span class="w">                               </span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymax&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymin&quot;</span><span class="p">]),</span>
<span class="w">                 </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dy</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;P1Y&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">aggregation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;median&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">resampling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bilinear&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Process NDVI</span>
<span class="w">  </span><span class="n">ndvi_rast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">raster_cube</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">select_bands</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">apply_pixel</span><span class="p">(</span><span class="s">&quot;(B08-B04)/(B08+B04)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NDVI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">write_tif</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="n">terra</span><span class="o">::</span><span class="nf">rast</span><span class="p">()</span>


<span class="w">  </span><span class="c1"># Convert terra Raster to ggplot using tidyterra</span>
<span class="n">ndvi_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">   </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_spatraster</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndvi_rast</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDVI</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">scale_fill_viridis_c</span><span class="p">(</span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;viridis&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NDVI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NDVI mean for 2023&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">coord_sf</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">      </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">      </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;right&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">())</span><span class="w"> </span>

<span class="w">  </span><span class="c1"># Save the plot as a high-resolution PNG file</span>
<span class="w">  </span><span class="nf">ggsave</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span><span class="w"> </span><span class="n">ndvi_plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Calculate processing time</span>
<span class="w">  </span><span class="n">end_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="w">  </span><span class="n">processing_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">difftime</span><span class="p">(</span><span class="n">end_time</span><span class="p">,</span><span class="w"> </span><span class="n">start_time</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Return the plot and processing time</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndvi_plot</span><span class="p">,</span><span class="w"> </span><span class="n">processing_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processing_time</span><span class="p">,</span><span class="w"> </span><span class="n">raster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndvi_rast</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Stream NDVI: high resolution
</summary>

<div class="highlight"><pre><span></span><code><span class="n">ndvi_background</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">yearly_average_ndvi</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0001</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0001</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../ndvi_00001.png" /></p>
<details>
<summary>
FUNCTION: Map NDVI per HOLC grade individually
</summary>

<div class="highlight"><pre><span></span><code><span class="n">create_mask_and_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">redlining_sf</span><span class="p">,</span><span class="w"> </span><span class="n">background_raster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndvi</span><span class="o">$</span><span class="n">raster</span><span class="p">,</span><span class="w"> </span><span class="n">roads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">rivers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">){</span>
<span class="w">  </span><span class="n">start_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span><span class="w">  </span><span class="c1"># Start timing</span>

<span class="w">  </span><span class="c1"># Validate and prepare the redlining data</span>
<span class="w">  </span><span class="n">redlining_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">redlining_sf</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">grade</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">st_make_valid</span><span class="p">()</span>


<span class="n">bbox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_bbox</span><span class="p">(</span><span class="n">redlining_sf</span><span class="p">)</span><span class="w">  </span><span class="c1"># Get original bounding box</span>


<span class="n">expanded_bbox</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">expand_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="m">6000</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">  </span><span class="c1"># </span>


<span class="n">expanded_bbox_poly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_as_sfc</span><span class="p">(</span><span class="n">expanded_bbox</span><span class="p">,</span><span class="w"> </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">st_crs</span><span class="p">(</span><span class="n">redlining_sf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">st_make_valid</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Initialize an empty list to store masks</span>
<span class="w">  </span><span class="n">masks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Iterate over each grade to create masks</span>
<span class="w">  </span><span class="n">unique_grades</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">redlining_sf</span><span class="o">$</span><span class="n">grade</span><span class="p">)</span>
<span class="w">  </span><span class="nf">for </span><span class="p">(</span><span class="n">grade</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">unique_grades</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Filter polygons by grade</span>
<span class="w">    </span><span class="n">grade_polygons</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">redlining_sf</span><span class="p">[</span><span class="n">redlining_sf</span><span class="o">$</span><span class="n">grade</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>

<span class="w">    </span><span class="c1"># Create an &quot;inverted&quot; mask by subtracting these polygons from the background</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_difference</span><span class="p">(</span><span class="n">expanded_bbox_poly</span><span class="p">,</span><span class="w"> </span><span class="nf">st_union</span><span class="p">(</span><span class="n">grade_polygons</span><span class="p">))</span>

<span class="w">    </span><span class="c1"># Store the mask in the list with the grade as the name</span>
<span class="w">    </span><span class="n">masks</span><span class="p">[[</span><span class="n">grade</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_sf</span><span class="p">(</span><span class="n">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">grade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grade</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1"># Combine all masks into a single sf object</span>
<span class="w">  </span><span class="n">mask_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">masks</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Normalize the grades so that C.2 becomes C, but correctly handle other grades</span>
<span class="w">  </span><span class="n">mask_sf</span><span class="o">$</span><span class="n">grade</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">mask_sf</span><span class="o">$</span><span class="n">grade</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;C.2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mask_sf</span><span class="o">$</span><span class="n">grade</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Prepare the plot</span>
<span class="w">  </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_spatraster</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">background_raster</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDVI</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_fill_viridis_c</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NDVI&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;viridis&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>

<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mask_sf</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grade</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;D&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Grade&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rivers</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NDVI: Normalized Difference Vegetation Index&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">coord_sf</span><span class="p">(</span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;xmax&quot;</span><span class="p">]),</span><span class="w"> </span>
<span class="w">           </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bbox</span><span class="p">[</span><span class="s">&quot;ymax&quot;</span><span class="p">]),</span><span class="w"> </span>
<span class="w">           </span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">())</span>

<span class="w">  </span><span class="c1"># Save the plot</span>
<span class="w">  </span><span class="nf">ggsave</span><span class="p">(</span><span class="s">&quot;redlining_mask_ndvi.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">)</span>

<span class="w">  </span><span class="n">end_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span><span class="w">  </span><span class="c1"># End timing</span>
<span class="w">  </span><span class="n">runtime</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span>

<span class="w">  </span><span class="c1"># Return the plot and runtime</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runtime</span><span class="p">,</span><span class="w"> </span><span class="n">mask_sf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mask_sf</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Stream NDVI: low resolution
</summary>

<div class="highlight"><pre><span></span><code><span class="n">ndvi_background_low</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">yearly_average_ndvi</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">)</span>
</code></pre></div>

</details>
<p><img alt="" src="../ndvi.png" /></p>
<details>
<summary>
Map low resolution NDVI per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">ndvi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">create_mask_and_plot</span><span class="p">(</span><span class="n">denver_redlining</span><span class="p">,</span><span class="w"> </span><span class="n">background_raster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndvi_background_low</span><span class="o">$</span><span class="n">raster</span><span class="p">,</span><span class="w"> </span><span class="n">roads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">rivers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rivers</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../redlining_mask_ndvi.png" /></p>
<details>
<summary>
FUNCTION: Map Denver City provided data per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">process_city_inventory_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">inner_file</span><span class="p">,</span><span class="w"> </span><span class="n">polygon_layer</span><span class="p">,</span><span class="w"> </span><span class="n">output_filename</span><span class="p">,</span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;Tree Density&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Download and read the shapefile</span>
<span class="w">  </span><span class="n">full_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glue</span><span class="p">(</span><span class="s">&quot;/vsizip/vsicurl/{address}/{inner_file}&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">shape_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_read</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">st_as_sf</span><span class="p">()</span>

<span class="w">  </span><span class="c1"># Process the shape data with the provided polygon layer</span>
<span class="w">  </span><span class="n">processed_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_and_plot_sf_layers</span><span class="p">(</span><span class="n">polygon_layer</span><span class="p">,</span><span class="w"> </span><span class="n">shape_data</span><span class="p">,</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">))</span>

<span class="w">  </span><span class="c1"># Extract trees from the processed data</span>
<span class="w">  </span><span class="n">trees</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">processed_data</span><span class="o">$</span><span class="n">sf</span>
<span class="w">  </span><span class="n">denver_redlining_residential</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon_layer</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">grade</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Generate the density plot</span>
<span class="w">  </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roads</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rivers</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">denver_redlining_residential</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">grade</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">stat_density_2d</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map_dbl</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">[</span><span class="m">1</span><span class="p">]),</span>
<span class="w">                                  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map_dbl</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">[</span><span class="m">2</span><span class="p">]),</span>
<span class="w">                                  </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stat</span><span class="p">(</span><span class="n">density</span><span class="p">)),</span>
<span class="w">                    </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;tile&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">scale_fill_gradientn</span><span class="p">(</span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;transparent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;limegreen&quot;</span><span class="p">),</span>
<span class="w">                         </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="nf">rescale</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span><span class="w">  </span><span class="c1"># Adjust these based on your density range</span>
<span class="w">                         </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;colourbar&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variable_label</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_tufte</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span>
<span class="w">          </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">          </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">())</span>

<span class="w">  </span><span class="c1"># Save the plot</span>
<span class="w">  </span><span class="nf">ggsave</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_density_plot.png&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># Return the plot and the tree layer</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

</details>
<details>
<summary>
Map tree inventory per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/tree_inventory/shape/tree_inventory.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;tree_inventory.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;Denver_tree_inventory_2023&quot;</span>
<span class="p">)</span>
</code></pre></div>

    Warning: `stat(density)` was deprecated in ggplot2 3.4.0.
    ℹ Please use `after_stat(density)` instead.

</details>

<p><img alt="" src="../Denver_tree_inventory_2023.png" />
<img alt="" src="../Denver_tree_inventory_2023_density_plot.png" /></p>
<details>
<summary>
Map traffic accidents per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/traffic_accidents/shape/traffic_accidents.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;traffic_accidents.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;Denver_traffic_accidents&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;Traffic accidents density&#39;</span>
<span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../Denver_traffic_accidents.png" />
<img alt="" src="../Denver_traffic_accidents_density_plot.png" /></p>
<details>
<summary>
Map stream sampling effort per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">instream_sampling_sites</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/instream_sampling_sites/shape/instream_sampling_sites.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;instream_sampling_sites.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;instream_sampling_sites&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;Instream sampling sites density&#39;</span>
<span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../instream_sampling_sites.png" />
<img alt="" src="../instream_sampling_sites_density_plot.png" /></p>
<details>
<summary>
Map soil sampling effort per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">soil_samples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/soil_samples/shape/soil_samples.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;soil_samples.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;Soil samples&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;soil samples density&#39;</span>
<span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../Soil%20samples.png" />
<img alt="" src="../Soil%20samples_density_plot.png" /></p>
<details>
<summary>
Map public art density per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">public_art</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/public_art/shape/public_art.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;public_art.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;Public art &quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;Public art density&#39;</span>
<span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../Public%20art%20.png" />
<img alt="" src="../Public%20art%20_density_plot.png" /></p>
<details>
<summary>
Map liquor licenses density per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">liquor_licenses</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/liquor_licenses/shape/liquor_licenses.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;liquor_licenses.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;liquor licenses &quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;liquor licenses density&#39;</span>
<span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../liquor%20licenses%20.png" />
<img alt="" src="../liquor%20licenses%20_density_plot.png" /></p>
<details>
<summary>
Map crime density per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">Crime</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/crime/shape/crime.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;crime.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;crime&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;Crime density&#39;</span>
<span class="p">)</span>
</code></pre></div>

</details>
<p><img alt="" src="../crime.png" /> <img alt="" src="../crime_density_plot.png" /></p>
<details>
<summary>
WORD CLOUD: Types of crimes
</summary>

<div class="highlight"><pre><span></span><code><span class="n">crime_cloud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">create_wordclouds_by_grade</span><span class="p">(</span><span class="n">Crime</span><span class="o">$</span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Crime_word_cloud_per_grade.png&quot;</span><span class="p">,</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Crime type where larger text is more frequent&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_size</span><span class="w"> </span><span class="o">=</span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">col_select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OFFENSE_TY&quot;</span><span class="p">)</span>
</code></pre></div>

    Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
    ℹ Please use `all_of()` or `any_of()` instead.
      # Was:
      data %>% select(col_select)

      # Now:
      data %>% select(all_of(col_select))

    See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.

</details>

<p><img alt="" src="../Crime_word_cloud_per_grade.png" /></p>
<details>
<summary>
Map police shooting density per HOLC grade
</summary>

<div class="highlight"><pre><span></span><code><span class="n">Denver_police_shootings</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">process_city_inventory_data</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;https://www.denvergov.org/media/gis/DataCatalog/denver_police_officer_involved_shootings/shape/denver_police_officer_involved_shootings.zip&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;denver_police_officer_involved_shootings.shp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">denver_redlining</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;Police shootings&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">variable_label</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;Police shootings density&#39;</span>
<span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../Police%20shootings.png" /></p>
<p><strong>Not enough data for density across all 4</strong></p>
<details>
<summary>
WORD CLOUD: Police involved shootings
</summary>

<div class="highlight"><pre><span></span><code><span class="n">Denver_police_shootings_cloud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">create_wordclouds_by_grade</span><span class="p">(</span><span class="n">Denver_police_shootings</span><span class="o">$</span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="n">output_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;police_shootings_word_cloud_per_grade.png&quot;</span><span class="p">,</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;police involved shooting per crime type where larger text is more frequent&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_size</span><span class="w"> </span><span class="o">=</span><span class="m">35</span><span class="p">,</span><span class="w"> </span><span class="n">col_select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SHOOT_ACTI&quot;</span><span class="p">)</span>
</code></pre></div>

</details>

<p><img alt="" src="../police_shootings_word_cloud_per_grade.png" /></p>
<h2 id="part-3-comparative-analysis-and-visualization">Part 3: Comparative Analysis and Visualization<a class="headerlink" href="#part-3-comparative-analysis-and-visualization" title="Permanent link">&para;</a></h2>
<h3 id="statistical-analysis">Statistical Analysis<a class="headerlink" href="#statistical-analysis" title="Permanent link">&para;</a></h3>
<ul>
<li>Conduct a detailed statistical analysis to compare greenspace across
    different HOLC grades, using techniques like Targeted Maximum
    Likelihood Estimation (TMLE) to assess the association between
    historical redlining and current greenspace levels.</li>
<li>Visualize the disparities in greenspace distribution using GIS
    tools, highlighting how redlining has shaped urban ecological
    landscapes.</li>
</ul>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>This tutorial provides tools and methodologies to explore the lingering
effects of historic redlining on urban greenspace, offering insights
into the intersection of urban planning, environmental justice, and
public health.</p>
<h3 id="references_1">References<a class="headerlink" href="#references_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Nardone, A., Rudolph, K. E., Morello-Frosch, R., &amp; Casey, J. A.
    (2021). Redlines and Greenspace: The Relationship between Historical
    Redlining and 2010 Greenspace across the United States.
    <em>Environmental Health Perspectives</em>, 129(1), 017006.
    DOI:10.1289/EHP7495. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7839347/pdf/ehp7495.pdf">Available
    online</a></li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2024-05-16
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../worksheet_0/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Explore an example (student edition)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Explore an example (student edition)
            </div>
          </div>
        </a>
      
      
        
        <a href="../worksheet_2/" class="md-footer__link md-footer__link--next" aria-label="Next: Make a plan" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Make a plan
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 University of Colorado Boulder
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "toc.integrate", "toc.follow", "content.code.copy"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>