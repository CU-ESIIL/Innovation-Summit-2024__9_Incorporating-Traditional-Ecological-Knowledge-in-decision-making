
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Summit 2024 Group 9">
      
      
        <meta name="author" content="ESIIL staff">
      
      
        <link rel="canonical" href="https://cu-esiil.github.io/innovation-summit-2024-group-9/data-library/stac_mount_save/">
      
      <link rel="icon" href="../../assets/esiil_content/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-8.5.10">
    
    
      
        <title>Stream data - ESIIL Innovation Summit 2024 Group 9</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-art-of-making-a-data-cube" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ESIIL Innovation Summit 2024 Group 9" class="md-header__button md-logo" aria-label="ESIIL Innovation Summit 2024 Group 9" data-md-component="logo">
      
  <img src="../../assets/esiil_content/ESIIL_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ESIIL Innovation Summit 2024 Group 9
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Stream data
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: white)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/CU-ESIIL/Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../virtual-meetings/" class="md-tabs__link md-tabs__link--active">
        Pre-Summit Virtual Trainings
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../worksheets/worksheet_0/" class="md-tabs__link">
        Group activities
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../agenda/" class="md-tabs__link">
        Additional resources
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ESIIL Innovation Summit 2024 Group 9" class="md-nav__button md-logo" aria-label="ESIIL Innovation Summit 2024 Group 9" data-md-component="logo">
      
  <img src="../../assets/esiil_content/ESIIL_logo.png" alt="logo">

    </a>
    ESIIL Innovation Summit 2024 Group 9
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CU-ESIIL/Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Pre-Summit Virtual Trainings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pre-Summit Virtual Trainings" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Pre-Summit Virtual Trainings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual-meetings/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Head in the clouds
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Head in the clouds" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Head in the clouds
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/markdown_basics/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/github_basics/" class="md-nav__link">
        Github
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_basics/" class="md-nav__link">
        Cyverse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_hacks/" class="md-nav__link">
        Cyverse hacks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Feet on the ground
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Feet on the ground" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Feet on the ground
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_startup/" class="md-nav__link">
        Startup procedure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../move-data-to-instance/" class="md-nav__link">
        Move and Save data
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Stream data
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stac_simple/" class="md-nav__link">
        Stream data (light)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/cyverse_shutdown/" class="md-nav__link">
        Shutdown procedure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trainings/training_three/" class="md-nav__link">
        Voices in Concert
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Group activities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Group activities" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Group activities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Day 1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 1" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Day 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../worksheets/worksheet_0/" class="md-nav__link">
        Explore an example (student edition)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../worksheets/worksheet_redlining/" class="md-nav__link">
        Explore an example (teacher edition)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../worksheets/worksheet_2/" class="md-nav__link">
        Make a plan
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Day 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 2" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Day 2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../worksheets/worksheet_3/" class="md-nav__link">
        Innovate as a team
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Day 3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 3" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Day 3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../worksheets/worksheet_4/" class="md-nav__link">
        Share your progress
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Additional resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Additional resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Additional resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../agenda/" class="md-nav__link">
        Agenda
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSfibPgHoYytmKvHkDiMxxbTNwdSupB2V2R_2zJC6BBw9asRMA/viewform" class="md-nav__link">
        Anonymous feedback form
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/code-of-conduct/" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/participant_agreement/" class="md-nav__link">
        Participant Agreement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/cyverse_hacks/" class="md-nav__link">
        Cyverse hacks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional-resources/useful_links/" class="md-nav__link">
        Useful links
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/CU-ESIIL/Innovation-Summit-2024__9_Incorporating-Traditional-Ecological-Knowledge-in-decision-making/edit/main/docs/data-library/stac_mount_save.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="the-art-of-making-a-data-cube">The art of making a data cube<a class="headerlink" href="#the-art-of-making-a-data-cube" title="Permanent link">&para;</a></h1>
<p>Ty Tuff, ESIIL Data Scientist
2023-10-27</p>
<div class="highlight"><pre><span></span><code><span class="c1">#library(Rcpp)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gdalcubes</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rstac</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gdalUtils</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">terra</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">osmdata</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">terra</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">colorspace</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">geos</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">osmdata</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>
<span class="nf">gdalcubes_options</span><span class="p">(</span><span class="n">parallel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>

<span class="n">sf</span><span class="o">::</span><span class="nf">sf_extSoftVersion</span><span class="p">()</span>
<span class="c1">##           GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H </span>
<span class="c1">##       &quot;3.11.0&quot;        &quot;3.5.3&quot;        &quot;9.1.0&quot;         &quot;true&quot;         &quot;true&quot; </span>
<span class="c1">##           PROJ </span>
<span class="c1">##        &quot;9.1.0&quot;</span>
<span class="nf">gdalcubes_gdal_has_geos</span><span class="p">()</span>
<span class="c1">## [1] TRUE</span>

<span class="nf">library</span><span class="p">(</span><span class="n">osmdata</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">terra</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyterra</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">landsat</span><span class="p">)</span>
</code></pre></div>
<h1 id="the-philosophy-of-moving-data-in-the-cloud">The philosophy of moving data in the cloud<a class="headerlink" href="#the-philosophy-of-moving-data-in-the-cloud" title="Permanent link">&para;</a></h1>
<p>The philosophy of moving data in the cloud represents a paradigm shift
in how we approach data within our analytical processes. Instead of the
traditional method of transferring entire datasets to our local
environments, the cloud encourages a more efficient model: bring your
analysis to the data. This approach minimizes data movement and
leverages the cloud’s computational power and scalability. By utilizing
cloud-native tools and services, we can run our analyses directly on the
data where it resides, selectively accessing and processing only what is
necessary. This not only streamlines workflows but also significantly
reduces overheads related to data transfer and storage management. In
essence, the focus is on diverting computational resources to the data
rather than the cumbersome and resource-intensive practice of moving
large datasets to and fro.</p>
<h2 id="to-make-or-to-take-a-photo">‘To Make’ or ‘To Take’ a photo<a class="headerlink" href="#to-make-or-to-take-a-photo" title="Permanent link">&para;</a></h2>
<p>The distinction between making and taking a photograph lies in the
approach and intent behind the camera. Taking a photo is often a
reactive process, where the photographer captures moments as they
naturally unfold, seizing the spontaneity of life without alteration.
It’s a passive form of photography where the emphasis is on the right
timing and the natural interplay of elements within the frame. On the
other hand, making a photo is a proactive and deliberate act. It is akin
to craftsmanship, where a professional photographer starts with a
concept and utilizes a variety of tools and techniques to stage and
construct the desired scene. They actively manipulate lighting,
composition, and subjects to create a photograph that aligns with their
pre-visualized artistic vision. While both methods use a camera to
produce a photograph, making a photo involves a creation process,
whereas taking a photo is about finding the scene.</p>
<p>David Yarrow is a famous photographer who ‘makes’ his photographs.
<img alt="" src="../../assets/esiil_content/stac_mount_save/David-Yarrow-sorrel-sky-gallery-Photographic-Print-Cindys-Shotgun-Wedding.png" />
<img alt="" src="../../assets/esiil_content/stac_mount_save/bison.png" /></p>
<h2 id="what-does-it-mean-to-make-a-data-cube">What does it mean to ‘make’ a data cube?<a class="headerlink" href="#what-does-it-mean-to-make-a-data-cube" title="Permanent link">&para;</a></h2>
<p>The artistry of Ansel Adams’ photography serves as a compelling analogy
for the meticulous craft of building a data cube from cloud data sources
using tools like STAC and GDAL VSI. Just as Adams would survey the
vastness of a landscape, discerning the interplay of light and shadow
upon the mountains before him, a data architect surveys the expanse of
available data. In this analogy, the raw data are the majestic mountains
and sweeping landscapes waiting to be captured. The STAC collection acts
as the photographer’s deliberate choice of scene, pointing the camera
lens—our data tools—towards the most telling and coherent dataset.</p>
<p><img alt="" src="../assets/stac_mount_save/Ansel_Adams_datacube.png" /> Just as Adams’
photographs are more than mere records of a landscape, but rather a
confluence of his vision, technique, and the scene’s natural beauty, so
too is the data cube more than the sum of its parts. It is the artful
synthesis of information, crafted and composed with the skill and intent
of an artist, producing not just a tool for analysis but a harmonized,
data-driven portrait of the world it represents. The builder of the data
cube is, indeed, an artist, and the data cube their masterpiece,
revealing not just data, but a story, a perspective, a landscape sewn
from the raw material of cloud-sourced information.</p>
<p>As Adams would adjust his viewfinder, setting the boundaries of his
photographic frame, the data builder sets the view window, filtering and
transferring relevant data to their own medium, akin to Adams’ film.
This is where the raw data is transformed, organized into the structured
form of a data frame or data cube, a process not unlike the careful
development of a photograph in a darkroom. Here, the data cube creator,
much like Adams with his careful dodging and burning, harmonizes
disparate elements into a cohesive whole, each decision reflecting an
intention and vision for the final product.</p>
<h2 id="1-the-rat-through-the-snake-problem-scalability-with-cloud-computing">1) The Rat through the Snake Problem: Scalability with Cloud Computing<a class="headerlink" href="#1-the-rat-through-the-snake-problem-scalability-with-cloud-computing" title="Permanent link">&para;</a></h2>
<p>Just like a snake that swallows a rat, traditional computing systems
often struggle to process the large volumes of environmental data —
they’re constrained by their static hardware limitations. Cloud
computing introduces a python-esque capability: massive scalability. By
migrating to the cloud, we essentially make the snake bigger, allowing
it to handle larger “prey.” Scalable computers in the cloud can grow
with the demand, providing the necessary computational power to process
extensive datasets, which is vital in a field where data volumes are
increasing exponentially.</p>
<p><img alt="Raster through a snake" src="../../assets/esiil_content/stac_mount_save/mouseinsnake.png" /></p>
<h2 id="2-the-antelope-through-the-python-problem-streamlining-with-gdal-vsi">2) The Antelope through the Python Problem: Streamlining with GDAL VSI<a class="headerlink" href="#2-the-antelope-through-the-python-problem-streamlining-with-gdal-vsi" title="Permanent link">&para;</a></h2>
<p>As we scale up, we encounter a new challenge: trying to pass an antelope
through a python — a metaphor for the next level of complexity in data
processing. The sheer size and complexity of the data can become
overwhelming. This is where GDAL’s Virtual File System (VSI) becomes our
ecological adaptation. VSI allows us to access remote data transparently
and more efficiently. Instead of ingesting the entire “antelope,” VSI
enables the “python” to dynamically access and process only the parts of
the data it needs, when it needs them, much like constriction before
digestion. This selective access minimizes the need for local storage
and expedites the data handling process.</p>
<p><img alt="Antelope through a Python" src="../../assets/esiil_content/stac_mount_save/antelopeinpython.png" /></p>
<h2 id="3-drinking-from-a-fire-hose-accelerated-inference-with-ai-and-ml">3) Drinking from a Fire Hose: Accelerated Inference with AI and ML<a class="headerlink" href="#3-drinking-from-a-fire-hose-accelerated-inference-with-ai-and-ml" title="Permanent link">&para;</a></h2>
<p>Once we’ve enabled the flow of large amounts of digestible data, we
encounter the metaphorical challenge of drinking from a fire hose. The
data, now flowing and accessible, is immense and rapid — posing a
challenge not just to store and process, but to understand and derive
meaning from in real-time. This is where artificial intelligence (AI)
and machine learning (ML) step in. These technologies act as a
sophisticated filtration system, enabling us to drink safely and
beneficially from the torrent. AI and ML can analyze patterns, make
predictions, and infer insights at a pace that keeps up with the fast
stream of data, turning raw information into actionable knowledge.</p>
<p><img alt="Inference through a firehose" src="../../assets/esiil_content/stac_mount_save/drink-firehose.png" /></p>
<p>By addressing these three pivotal challenges with cloud computing, GDAL
VSI, and AI/ML, we not only manage to consume the data effectively but
also transform our capabilities in environmental data science. We can
move from mere data ingestion to meaningful data interpretation, all at
a scale and speed necessary for impactful environmental analysis.</p>
<h3 id="mounting-data">Mounting data<a class="headerlink" href="#mounting-data" title="Permanent link">&para;</a></h3>
<p>A void-filled Digital Elevation Model (DEM) is a comprehensive
topographical representation where any missing data points, known as
voids, have been filled in. These voids can occur due to various
reasons, such as clouds or technical errors during data collection. In a
void-filled DEM, these gaps are interpolated or estimated using the
surrounding data to create a continuous, seamless surface model. This
process enhances the utility and accuracy of the DEM for hydrological
modeling, terrain analysis, and other geographical applications. The
HydroSHEDS website
(<a href="https://www.hydrosheds.org/hydrosheds-core-downloads">https://www.hydrosheds.org/hydrosheds-core-downloads</a>) provides access
to high-quality, void-filled DEM datasets like the
DEM_continuous_CONUS_15s, which users can download and easily integrate
into spatial analysis workflows using tools such as ‘terra’ in R,
allowing for sophisticated environmental and geographical research and
planning.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span><span class="w">  </span>

<span class="c1"># Create a string with the file path using glue, then download and read the DEM file as a raster object</span>

<span class="n">DEM_continuous_CONUS_15s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glue</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;/vsizip/vsicurl/&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">#magic remote connection </span>
<span class="w">  </span><span class="s">&quot;https://data.hydrosheds.org/file/hydrosheds-v1-dem/hyd_na_dem_15s.zip&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">#copied link to download location</span>
<span class="w">  </span><span class="s">&quot;/hyd_na_dem_15s.tif&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1">#path inside zip file</span>
<span class="w">  </span><span class="n">terra</span><span class="o">::</span><span class="nf">rast</span><span class="p">()</span><span class="w">  </span>

<span class="c1"># The &#39;glue&#39; function constructs the file path string, which is then passed to &#39;terra::rast()&#39; to read the DEM file into R as a raster layer. &#39;/vsizip/vsicurl/&#39; is a special GDAL virtual file system syntax that allows reading directly from a zipped file on a remote server.</span>

<span class="c1"># Record end time and calculate the time difference</span>
<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span><span class="w">  </span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span>
<span class="c1">## Time difference of 4.603666 secs</span>

<span class="c1"># The resulting raster object is stored in &#39;DEM_continuous_CONUS_15s&#39;, which now contains the void-filled DEM data ready for use</span>

<span class="n">DEM_continuous_CONUS_15s</span><span class="w">  </span><span class="c1"># Prints out the details of the &#39;DEM_continuous_CONUS_15s&#39; raster object</span>
<span class="c1">## class       : SpatRaster </span>
<span class="c1">## dimensions  : 13920, 20640, 1  (nrow, ncol, nlyr)</span>
<span class="c1">## resolution  : 0.004166667, 0.004166667  (x, y)</span>
<span class="c1">## extent      : -138, -52, 5, 63  (xmin, xmax, ymin, ymax)</span>
<span class="c1">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span>
<span class="c1">## source      : hyd_na_dem_15s.tif </span>
<span class="c1">## name        : Band_1</span>

<span class="c1"># output is a SpatRaster, which is the object type associated with the &#39;terra&#39; package. </span>
</code></pre></div>
<p>Continuous DEM for North America</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_spatraster</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">DEM_continuous_CONUS_15s</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_tufte</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="stac_mount_save_files/figure-gfm/DEM_plot-1.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 52.49061 secs</span>
</code></pre></div>
<p>Calculate Slope from that DEM</p>
<div class="highlight"><pre><span></span><code><span class="n">SLOPE_continuous_CONUS_15s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">terra</span><span class="o">::</span><span class="nf">terrain</span><span class="p">(</span><span class="n">DEM_continuous_CONUS_15s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slope&quot;</span><span class="p">)</span><span class="w"> </span>

<span class="n">SLOPE_continuous_CONUS_15s</span>
<span class="c1">## class       : SpatRaster </span>
<span class="c1">## dimensions  : 13920, 20640, 1  (nrow, ncol, nlyr)</span>
<span class="c1">## resolution  : 0.004166667, 0.004166667  (x, y)</span>
<span class="c1">## extent      : -138, -52, 5, 63  (xmin, xmax, ymin, ymax)</span>
<span class="c1">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span>
<span class="c1">## source(s)   : memory</span>
<span class="c1">## name        :    slope </span>
<span class="c1">## min value   :  0.00000 </span>
<span class="c1">## max value   : 56.98691</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_spatraster</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">SLOPE_continuous_CONUS_15s</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_tufte</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="stac_mount_save_files/figure-gfm/SLOPE_plot-1.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 3.859545 secs</span>
</code></pre></div>
<p>Calculate aspect from DEM</p>
<div class="highlight"><pre><span></span><code><span class="n">ASPECT_continuous_CONUS_15s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">terra</span><span class="o">::</span><span class="nf">terrain</span><span class="p">(</span><span class="n">DEM_continuous_CONUS_15s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aspect&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="n">ASPECT_continuous_CONUS_15s</span>
<span class="c1">## class       : SpatRaster </span>
<span class="c1">## dimensions  : 13920, 20640, 1  (nrow, ncol, nlyr)</span>
<span class="c1">## resolution  : 0.004166667, 0.004166667  (x, y)</span>
<span class="c1">## extent      : -138, -52, 5, 63  (xmin, xmax, ymin, ymax)</span>
<span class="c1">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span>
<span class="c1">## source(s)   : memory</span>
<span class="c1">## name        : aspect </span>
<span class="c1">## min value   :      0 </span>
<span class="c1">## max value   :    360</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_spatraster</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ASPECT_continuous_CONUS_15s</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_tufte</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="stac_mount_save_files/figure-gfm/ASPECT_plot-1.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 3.650267 secs</span>
</code></pre></div>
<p>Create a cube from those layers!</p>
<div class="highlight"><pre><span></span><code><span class="n">mini_stack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">DEM_continuous_CONUS_15s</span><span class="p">,</span><span class="w"> </span><span class="n">SLOPE_continuous_CONUS_15s</span><span class="p">,</span><span class="n">ASPECT_continuous_CONUS_15s</span><span class="p">)</span>
<span class="n">mini_stack</span>
<span class="c1">## class       : SpatRaster </span>
<span class="c1">## dimensions  : 13920, 20640, 3  (nrow, ncol, nlyr)</span>
<span class="c1">## resolution  : 0.004166667, 0.004166667  (x, y)</span>
<span class="c1">## extent      : -138, -52, 5, 63  (xmin, xmax, ymin, ymax)</span>
<span class="c1">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span>
<span class="c1">## sources     : hyd_na_dem_15s.tif  </span>
<span class="c1">##               memory  </span>
<span class="c1">##               memory  </span>
<span class="c1">## names       : Band_1,    slope, aspect </span>
<span class="c1">## min values  :     ? ,  0.00000,      0 </span>
<span class="c1">## max values  :     ? , 56.98691,    360</span>
</code></pre></div>
<p>Reproject and return the bounding box coordinates for our Area of
Interest</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Transform the filtered geometry to EPSG:4326 and store its bounding box</span>
<span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="n">DEM_continuous_CONUS_15s</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="n">stars</span><span class="o">::</span><span class="nf">st_as_stars</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">st_transform</span><span class="p">(</span><span class="s">&quot;EPSG:4326&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_bbox</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bbox_4326</span>


<span class="n">DEM_continuous_CONUS_15s</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="n">stars</span><span class="o">::</span><span class="nf">st_as_stars</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">st_transform</span><span class="p">(</span><span class="s">&quot;EPSG:32618&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_bbox</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bbox_32618</span>

<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 3.7653 mins</span>
</code></pre></div>
<p>Get a polygon for Boulder County, reproject, and return bounding box.
This is so I can make a smaller search in the stac catalog.</p>
<div class="highlight"><pre><span></span><code><span class="n">boulder_county</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">getbb</span><span class="p">(</span><span class="s">&quot;boulder, co&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">format_out</span><span class="o">=</span><span class="s">&quot;sf_polygon&quot;</span><span class="p">)</span>

<span class="n">boulder_county</span><span class="o">$</span><span class="n">multipolygon</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">st_transform</span><span class="p">(</span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="m">4326</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_bbox</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bbox_4326_boulder</span>

<span class="n">boulder_county</span><span class="o">$</span><span class="n">multipolygon</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">st_transform</span><span class="p">(</span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="m">32720</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_bbox</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bbox_32720_boulder</span>
</code></pre></div>
<p>Get a polygon for the United States and crop it to be the same size as
the DEM above.</p>
<div class="highlight"><pre><span></span><code><span class="n">aoi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">getbb</span><span class="p">(</span><span class="s">&quot;United States&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">format_out</span><span class="o">=</span><span class="s">&quot;sf_polygon&quot;</span><span class="p">)</span>

<span class="n">conus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aoi</span><span class="o">$</span><span class="n">multipolygon</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_crop</span><span class="p">(</span><span class="n">bbox_4326</span><span class="p">)</span>


<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">conus</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_sf</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="stac_mount_save_files/figure-gfm/conus_bounding_box-1.png" /></p>
<p>Search the Stac catalog.</p>
<p>STAC, or SpatioTemporal Asset Catalog, is an open-source specification
designed to standardize the way geospatial data is indexed and
discovered. Developed by Element 84 among others, it facilitates better
interoperability and sharing of geospatial assets by providing a common
language for describing them. STAC’s flexible design allows for easy
cataloging of data, making it simpler for individuals and systems to
search and retrieve geospatial information. By effectively organizing
data about the Earth’s spatial and temporal characteristics, STAC
enables users to harness the full power of the cloud and modern data
processing technologies, optimizing the way we access and analyze
environmental data on a global scale.</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="nf">stac</span><span class="p">(</span><span class="s">&quot;https://earth-search.aws.element84.com/v1&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">       </span><span class="nf">get_request</span><span class="p">()</span>
<span class="c1">## ###STACCatalog</span>
<span class="c1">## - id: earth-search-aws</span>
<span class="c1">## - description: A STAC API of public datasets on AWS</span>
<span class="c1">## - field(s): stac_version, type, id, title, description, links, conformsTo</span>
</code></pre></div>
<p>Element 84’s Earth Search is a STAC compliant search and discovery API
that offers users access to a vast collection of geospatial open
datasets hosted on AWS. It serves as a centralized search catalog
providing standardized metadata for these open datasets, designed to be
freely used and integrated into various applications. Alongside the API,
Element 84 also provides a web application named Earth Search Console,
which is map-centric and allows users to explore and visualize the data
contained within the Earth Search API’s catalog. This suite of tools is
part of Element 84’s initiative to make geospatial data more accessible
and actionable for a wide range of users and applications.</p>
<div class="highlight"><pre><span></span><code><span class="nf">collection_formats</span><span class="p">()</span>
<span class="c1">##    CHIRPS_v2_0_daily_p05_tif | Image collection format for CHIRPS v 2.0 daily</span>
<span class="c1">##                              | global precipitation dataset (0.05 degrees</span>
<span class="c1">##                              | resolution) from GeoTIFFs, expects list of .tif</span>
<span class="c1">##                              | or .tif.gz files as input. [TAGS: CHIRPS,</span>
<span class="c1">##                              | precipitation]</span>
<span class="c1">##  CHIRPS_v2_0_monthly_p05_tif | Image collection format for CHIRPS v 2.0 monthly</span>
<span class="c1">##                              | global precipitation dataset (0.05 degrees</span>
<span class="c1">##                              | resolution) from GeoTIFFs, expects list of .tif</span>
<span class="c1">##                              | or .tif.gz files as input. [TAGS: CHIRPS,</span>
<span class="c1">##                              | precipitation]</span>
<span class="c1">##            ESA_CCI_SM_ACTIVE | Collection format for ESA CCI soil moisture</span>
<span class="c1">##                              | active product (version 4.7) [TAGS: Soil</span>
<span class="c1">##                              | Moisture, ESA, CCI]</span>
<span class="c1">##           ESA_CCI_SM_PASSIVE | Collection format for ESA CCI soil moisture</span>
<span class="c1">##                              | passive product (version 4.7) [TAGS: Soil</span>
<span class="c1">##                              | Moisture, ESA, CCI]</span>
<span class="c1">##    GPM_IMERG_3B_DAY_GIS_V06A | Collection format for daily</span>
<span class="c1">##                              | IMERG_3B_DAY_GIS_V06A data [TAGS: Precipitation,</span>
<span class="c1">##                              | GPM, IMERG]</span>
<span class="c1">##                      L8_L1TP | Collection format for Landsat 8 Level 1 TP</span>
<span class="c1">##                              | product [TAGS: Landsat, USGS, Level 1, NASA]</span>
<span class="c1">##                        L8_SR | Collection format for Landsat 8 surface</span>
<span class="c1">##                              | reflectance product [TAGS: Landsat, USGS, Level</span>
<span class="c1">##                              | 2, NASA, surface reflectance]</span>
<span class="c1">##                        MAXAR | Preliminary collection format for MAXAR open</span>
<span class="c1">##                              | data, visual only (under development) [TAGS: ]</span>
<span class="c1">##                      MxD09GA | Collection format for selected bands from the</span>
<span class="c1">##                              | MODIS MxD09GA (Aqua and Terra) product [TAGS:</span>
<span class="c1">##                              | MODIS, surface reflectance]</span>
<span class="c1">##                      MxD10A2 | Collection format for selected bands from the</span>
<span class="c1">##                              | MODIS MxD10A2 (Aqua and Terra) v006 Snow Cover</span>
<span class="c1">##                              | product [TAGS: MODIS, Snow Cover]</span>
<span class="c1">##                      MxD11A1 | Collection format for selected bands from the</span>
<span class="c1">##                              | MODIS MxD11A2 (Aqua and Terra) v006 Land Surface</span>
<span class="c1">##                              | Temperature product [TAGS: MODIS, LST]</span>
<span class="c1">##                      MxD11A2 | Collection format for selected bands from the</span>
<span class="c1">##                              | MODIS MxD11A2 (Aqua and Terra) v006 Land Surface</span>
<span class="c1">##                              | Temperature product [TAGS: MODIS, LST]</span>
<span class="c1">##                      MxD13A2 | Collection format for selected bands from the</span>
<span class="c1">##                              | MODIS MxD13A2 (Aqua and Terra) product [TAGS:</span>
<span class="c1">##                              | MODIS, VI, NDVI, EVI]</span>
<span class="c1">##                      MxD13A3 | Collection format for selected bands from the</span>
<span class="c1">##                              | MODIS MxD13A3 (Aqua and Terra) product [TAGS:</span>
<span class="c1">##                              | MODIS, VI, NDVI, EVI]</span>
<span class="c1">##                      MxD13Q1 | Collection format for selected bands from the</span>
<span class="c1">##                              | MODIS MxD13Q1 (Aqua and Terra) product [TAGS:</span>
<span class="c1">##                              | MODIS, VI, NDVI, EVI]</span>
<span class="c1">##                      MxD14A2 | Collection format for the MODIS MxD14A2 (Aqua</span>
<span class="c1">##                              | and Terra) product [TAGS: MODIS, Fire]</span>
<span class="c1">## PlanetScope_3B_AnalyticMS_SR | Image collection format for PlanetScope 4-band</span>
<span class="c1">##                              | scenes [TAGS: PlanetScope, BOA, Surface</span>
<span class="c1">##                              | Reflectance]</span>
<span class="c1">##                Sentinel2_L1C | Image collection format for Sentinel 2 Level 1C</span>
<span class="c1">##                              | data as downloaded from the Copernicus Open</span>
<span class="c1">##                              | Access Hub, expects a list of file paths as</span>
<span class="c1">##                              | input. The format works on original ZIP</span>
<span class="c1">##                              | compressed as well as uncompressed imagery.</span>
<span class="c1">##                              | [TAGS: Sentinel, Copernicus, ESA, TOA]</span>
<span class="c1">##            Sentinel2_L1C_AWS | Image collection format for Sentinel 2 Level 1C</span>
<span class="c1">##                              | data in AWS [TAGS: Sentinel, Copernicus, ESA,</span>
<span class="c1">##                              | TOA]</span>
<span class="c1">##                Sentinel2_L2A | Image collection format for Sentinel 2 Level 2A</span>
<span class="c1">##                              | data as downloaded from the Copernicus Open</span>
<span class="c1">##                              | Access Hub, expects a list of file paths as</span>
<span class="c1">##                              | input. The format should work on original ZIP</span>
<span class="c1">##                              | compressed as well as uncompressed imagery.</span>
<span class="c1">##                              | [TAGS: Sentinel, Copernicus, ESA, BOA, Surface</span>
<span class="c1">##                              | Reflectance]</span>
<span class="c1">##          Sentinel2_L2A_THEIA | Image collection format for Sentinel 2 Level 2A</span>
<span class="c1">##                              | data as downloaded from Theia. [TAGS: Sentinel,</span>
<span class="c1">##                              | ESA, Flat Reflectance, Theia]</span>
</code></pre></div>
<p>Building a stac collection by aiming your camera at the landscape</p>
<p>Creating a STAC collection is akin to a photographer framing a shot; the
landscape is rich with diverse data, mirroring a scene bustling with
potential subjects, colors, and light. Just as a photographer selects a
portion of the vista to capture, focusing on elements that will compose
a compelling image, a data scientist must similarly navigate the vast
data terrain. They must ‘point their camera’ judiciously, ensuring that
the ‘frame’ encapsulates the precise data needed. This careful selection
is crucial, as it determines the relevance and quality of the data
collection, much like the photographer’s choice dictates the story a
photograph will tell.</p>
<p><img alt="" src="../../assets/esiil_content/stac_mount_save/Ansel_adams_Jackson_hole.png" /></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="c1"># Initialize STAC connection</span>
<span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stac</span><span class="p">(</span><span class="s">&quot;https://earth-search.aws.element84.com/v0&quot;</span><span class="p">)</span>


<span class="c1"># Search for Sentinel-2 images within specified bounding box and date range</span>
<span class="c1">#22 Million items</span>
<span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">stac_search</span><span class="p">(</span><span class="n">collections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sentinel-s2-l2a-cogs&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">bbox_4326_boulder</span><span class="p">[</span><span class="s">&quot;xmin&quot;</span><span class="p">],</span><span class="w"> </span>
<span class="w">                         </span><span class="n">bbox_4326_boulder</span><span class="p">[</span><span class="s">&quot;ymin&quot;</span><span class="p">],</span>
<span class="w">                         </span><span class="n">bbox_4326_boulder</span><span class="p">[</span><span class="s">&quot;xmax&quot;</span><span class="p">],</span><span class="w"> </span>
<span class="w">                         </span><span class="n">bbox_4326_boulder</span><span class="p">[</span><span class="s">&quot;ymax&quot;</span><span class="p">]),</span><span class="w"> </span>
<span class="w">                </span><span class="n">datetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-05-15/2021-05-16&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">post_request</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">items_fetch</span><span class="p">(</span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>

<span class="c1"># Print number of found items</span>
<span class="nf">length</span><span class="p">(</span><span class="n">items</span><span class="o">$</span><span class="n">features</span><span class="p">)</span>
<span class="c1">## [1] 1</span>

<span class="c1"># Prepare the assets for analysis</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gdalcubes</span><span class="p">)</span>
<span class="n">assets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B02&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B03&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B05&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B06&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="s">&quot;B07&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="s">&quot;B08&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B8A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B09&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B11&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B12&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SCL&quot;</span><span class="p">)</span>
<span class="n">s2_collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stac_image_collection</span><span class="p">(</span><span class="n">items</span><span class="o">$</span><span class="n">features</span><span class="p">,</span><span class="w"> </span><span class="n">asset_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assets</span><span class="p">,</span>
<span class="n">property_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;eo:cloud_cover&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">20</span><span class="p">})</span><span class="w"> </span><span class="c1">#all images with less than 20% clouds</span>

<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 0.4706092 secs</span>

<span class="c1"># Display the image collection</span>
<span class="n">s2_collection</span>
<span class="c1">## Image collection object, referencing 1 images with 13 bands</span>
<span class="c1">## Images:</span>
<span class="c1">##                       name      left      top   bottom     right</span>
<span class="c1">## 1 S2B_13TDE_20210516_0_L2A -106.1832 40.65079 39.65576 -104.8846</span>
<span class="c1">##              datetime        srs</span>
<span class="c1">## 1 2021-05-16T18:02:54 EPSG:32613</span>
<span class="c1">## </span>
<span class="c1">## Bands:</span>
<span class="c1">##    name offset scale unit nodata image_count</span>
<span class="c1">## 1   B01      0     1                       1</span>
<span class="c1">## 2   B02      0     1                       1</span>
<span class="c1">## 3   B03      0     1                       1</span>
<span class="c1">## 4   B04      0     1                       1</span>
<span class="c1">## 5   B05      0     1                       1</span>
<span class="c1">## 6   B06      0     1                       1</span>
<span class="c1">## 7   B07      0     1                       1</span>
<span class="c1">## 8   B08      0     1                       1</span>
<span class="c1">## 9   B09      0     1                       1</span>
<span class="c1">## 10  B11      0     1                       1</span>
<span class="c1">## 11  B12      0     1                       1</span>
<span class="c1">## 12  B8A      0     1                       1</span>
<span class="c1">## 13  SCL      0     1                       1</span>
</code></pre></div>
<p>Setting up your camera and film</p>
<p>The camera through which the data scientist frames the shot is
multifaceted, akin to the tools and processes they employ. The camera’s
film, analogous to the data cube, defines the resolution and dimensions
of the captured data, shaping how the final dataset will be utilized.
The lens and its settings—focus, aperture, and exposure—determine the
clarity, depth, and breadth of the captured information, much like the
algorithms and parameters set by the data scientist dictate the
granularity and scope of the data cube. The flash, like data enhancement
techniques, can illuminate hidden details, ensuring that the data cube,
the final product, is as informative and accurate as the landscape it
represents.</p>
<p><img alt="" src="../../assets/esiil_content/stac_mount_save/View_Ansel-Adams_Camera.png" /></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="c1"># Define a specific view on the satellite image collection</span>
<span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cube_view</span><span class="p">(</span>
<span class="w">    </span><span class="n">srs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EPSG:32720&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">#this is harder than expected. </span>
<span class="w">    </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;P1M&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">aggregation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;median&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">resampling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;near&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">        </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-05-15&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-05-16&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="m">2</span><span class="p">],</span>
<span class="w">        </span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="n">bottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="m">3</span><span class="p">]</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>

<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 0.002738953 secs</span>

<span class="c1"># Display the defined view</span>
<span class="n">v</span>
<span class="c1">## A data cube view object</span>
<span class="c1">## </span>
<span class="c1">## Dimensions:</span>
<span class="c1">##                 low             high  count pixel_size</span>
<span class="c1">## t        2021-05-01       2021-05-31      1        P1M</span>
<span class="c1">## y -3103099.52398788 15434400.4760121 185375        100</span>
<span class="c1">## x -3178878.98542359 15369521.0145764 185484        100</span>
<span class="c1">## </span>
<span class="c1">## SRS: &quot;EPSG:32720&quot;</span>
<span class="c1">## Temporal aggregation method: &quot;median&quot;</span>
<span class="c1">## Spatial resampling method: &quot;near&quot;</span>
</code></pre></div>
<p>Take a picture!</p>
<p>Raster style</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="n">s2_collection</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">raster_cube</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">select_bands</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B05&quot;</span><span class="p">))</span><span class="w">  </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">apply_pixel</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;(B05-B04)/(B05+B04)&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">names</span><span class="o">=</span><span class="s">&quot;NDVI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">write_tif</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="n">raster</span><span class="o">::</span><span class="nf">stack</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span>
<span class="n">x</span>
<span class="c1">## class      : RasterStack </span>
<span class="c1">## dimensions : 185375, 185484, 34384096500, 1  (nrow, ncol, ncell, nlayers)</span>
<span class="c1">## resolution : 100, 100  (x, y)</span>
<span class="c1">## extent     : -3178879, 15369521, -3103100, 15434400  (xmin, xmax, ymin, ymax)</span>
<span class="c1">## crs        : +proj=utm +zone=20 +south +datum=WGS84 +units=m +no_defs </span>
<span class="c1">## names      : NDVI</span>

<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 4.132932 mins</span>
</code></pre></div>
<p>STARS style</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="n">s2_collection</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">raster_cube</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">select_bands</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="s">&quot;B05&quot;</span><span class="p">))</span><span class="w">  </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">apply_pixel</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;(B05-B04)/(B05+B04)&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">names</span><span class="o">=</span><span class="s">&quot;NDVI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="n">stars</span><span class="o">::</span><span class="nf">st_as_stars</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">y</span>

<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 1.459866 mins</span>

<span class="n">y</span>
<span class="c1">## stars_proxy object with 1 attribute in 1 file(s):</span>
<span class="c1">## $NDVI</span>
<span class="c1">## [1] &quot;[...]/filec5982c38536c.nc:NDVI&quot;</span>
<span class="c1">## </span>
<span class="c1">## dimension(s):</span>
<span class="c1">##      from     to   offset delta                refsys point</span>
<span class="c1">## x       1 185484 -3178879   100 WGS 84 / UTM zone 20S    NA</span>
<span class="c1">## y       1 185375 15434400  -100 WGS 84 / UTM zone 20S    NA</span>
<span class="c1">## time    1      1       NA    NA               POSIXct FALSE</span>
<span class="c1">##                       values x/y</span>
<span class="c1">## x                       NULL [x]</span>
<span class="c1">## y                       NULL [y]</span>
<span class="c1">## time [2021-05-01,2021-06-01)</span>
</code></pre></div>
<p>Extract data</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>


<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s2_collection</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">raster_cube</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">select_bands</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B02&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B03&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                   </span><span class="s">&quot;B05&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B06&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B07&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                   </span><span class="s">&quot;B8A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B09&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B11&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B12&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">extract_geom</span><span class="p">(</span><span class="n">boulder_county</span><span class="o">$</span><span class="n">multipolygon</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">rename</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;time&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;443&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B01&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;490&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B02&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;560&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B03&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;665&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B04&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;705&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B05&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;740&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B06&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;783&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B07&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;842&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;865&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B8A&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;940&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B09&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;1610&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B11&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;2190&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;B12&quot;</span>
<span class="w">    </span><span class="p">)</span>

<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 1.699016 mins</span>

<span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">##   FID       time   443   490   560   665   705   740   783   842  865  940 1610</span>
<span class="c1">## 1   1 2021-05-01 11096 10929 10224  9893  9956  9706  9715  9641 9511 8459 5682</span>
<span class="c1">## 2   1 2021-05-01 11631 11282 10550 10234 10288 10031 10032  9988 9828 9153 5802</span>
<span class="c1">## 3   1 2021-05-01 11900 11393 10666 10337 10398 10142 10138 10093 9927 9461 5754</span>
<span class="c1">## 4   1 2021-05-01 11406 10597  9928  9626  9694  9481  9516  9338 9336 8959 5726</span>
<span class="c1">## 5   1 2021-05-01 11399 10939 10237  9905  9978  9738  9746  9633 9555 8925 5831</span>
<span class="c1">## 6   1 2021-05-01 11600 11174 10462 10147 10209  9952  9960  9890 9760 9153 5773</span>
<span class="c1">##   2190</span>
<span class="c1">## 1 3917</span>
<span class="c1">## 2 3981</span>
<span class="c1">## 3 3937</span>
<span class="c1">## 4 4054</span>
<span class="c1">## 5 4097</span>
<span class="c1">## 6 3990</span>
</code></pre></div>
<p>Make a timeseries</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Record start time</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>

<span class="n">items</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">stac_search</span><span class="p">(</span><span class="n">collections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sentinel-s2-l2a-cogs&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-105.694362</span><span class="p">,</span><span class="w">   </span><span class="m">39.912886</span><span class="p">,</span><span class="w">  </span><span class="m">-105.052774</span><span class="p">,</span><span class="w">    </span><span class="m">40.262785</span><span class="p">),</span>
<span class="w">                </span><span class="n">datetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2020-01-01/2022-12-31&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">post_request</span><span class="p">()</span><span class="w"> </span>

<span class="n">S2.mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">image_mask</span><span class="p">(</span><span class="s">&quot;SCL&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">))</span>

<span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stac_image_collection</span><span class="p">(</span><span class="n">items</span><span class="o">$</span><span class="n">features</span><span class="p">,</span><span class="w"> </span><span class="n">asset_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assets</span><span class="p">,</span><span class="w"> </span>
<span class="w">                            </span><span class="n">property_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="p">[[</span><span class="s">&quot;eo:cloud_cover&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">30</span><span class="p">})</span>

<span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cube_view</span><span class="p">(</span><span class="n">srs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EPSG:4326&quot;</span><span class="p">,</span><span class="w">  </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2020-01-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2022-12-31&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-105.694362</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-105.052774</span><span class="p">,</span><span class="w">  </span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40.262785</span><span class="p">,</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">39.912886</span><span class="p">),</span>
<span class="w">              </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.001</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.001</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;P1M&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">aggregation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;median&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">resampling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bilinear&quot;</span><span class="p">)</span>

<span class="nf">library</span><span class="p">(</span><span class="n">colorspace</span><span class="p">)</span>
<span class="n">ndvi.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">rev</span><span class="p">(</span><span class="nf">sequential_hcl</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Green-Yellow&quot;</span><span class="p">))</span>
<span class="p">}</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gdalcubes</span><span class="p">)</span>
<span class="nf">raster_cube</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S2.mask</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">select_bands</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">apply_pixel</span><span class="p">(</span><span class="s">&quot;(B08-B04)/(B08+B04)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NDVI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="n">gdalcubes</span><span class="o">::</span><span class="nf">animate</span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndvi.col</span><span class="p">,</span><span class="w"> </span><span class="n">zlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-0.2</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">key.pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">save_as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;anim.gif&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
<span class="c1">## [1] &quot;/Users/ty/Documents/Github/hackathon2023_datacube/docs/code_for_building_cube/anim.gif&quot;</span>

<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">difftime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="c1">## Time difference of 4.716672 mins</span>

<span class="n">y</span>
<span class="c1">## stars_proxy object with 1 attribute in 1 file(s):</span>
<span class="c1">## $NDVI</span>
<span class="c1">## [1] &quot;[...]/filec5982c38536c.nc:NDVI&quot;</span>
<span class="c1">## </span>
<span class="c1">## dimension(s):</span>
<span class="c1">##      from     to   offset delta                refsys point</span>
<span class="c1">## x       1 185484 -3178879   100 WGS 84 / UTM zone 20S    NA</span>
<span class="c1">## y       1 185375 15434400  -100 WGS 84 / UTM zone 20S    NA</span>
<span class="c1">## time    1      1       NA    NA               POSIXct FALSE</span>
<span class="c1">##                       values x/y</span>
<span class="c1">## x                       NULL [x]</span>
<span class="c1">## y                       NULL [y]</span>
<span class="c1">## time [2021-05-01,2021-06-01)</span>
</code></pre></div>
<p><img alt="" src="../../assets/esiil_content/stac_mount_save/anim.gif" /></p>
<p>Saving Data Cubes to Local Storage There are occasions when we need to
manipulate data cubes using other software. For such purposes, we can
save data cubes to our local disk as individual netCDF files or as a
series of GeoTIFF files. In the case of the latter, each temporal
segment of the cube is saved as a separate (multiband) GeoTIFF file.</p>
<p>Both netCDF and GeoTIFF formats allow for file size reduction through
compression and data packing. This process involves transforming double
precision numbers into smaller integer values using a scale and offset,
which can be particularly useful for managing disk space (for more
details, refer to the ?write_ncdf and ?write_tif documentation).</p>
<div class="highlight"><pre><span></span><code><span class="nf">gdalcubes_options</span><span class="p">(</span><span class="n">ncdf_compression_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="nf">write_ncdf</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span><span class="w"> </span><span class="nf">file.path</span><span class="p">(</span><span class="s">&quot;~/Desktop&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">basename</span><span class="p">(</span><span class="nf">tempfile</span><span class="p">(</span><span class="n">fileext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;.nc&quot;</span><span class="p">))))</span>
<span class="nf">gdalcubes_options</span><span class="p">(</span><span class="n">ncdf_compression_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</code></pre></div>
<p>write_tif() and write_ncdf() both return the path(s) to created file(s)
as a character vector.</p>
<div class="highlight"><pre><span></span><code><span class="n">items_2020</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">stac_search</span><span class="p">(</span><span class="n">collections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sentinel-s2-l2a-cogs&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-105.694362</span><span class="p">,</span><span class="w">   </span><span class="m">39.912886</span><span class="p">,</span><span class="w">  </span><span class="m">-105.052774</span><span class="p">,</span><span class="w">    </span><span class="m">40.262785</span><span class="p">),</span>
<span class="w">                </span><span class="n">datetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2020-05-01/2020-06-30&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="nf">post_request</span><span class="p">()</span><span class="w"> </span>

<span class="n">items_2021</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">stac_search</span><span class="p">(</span><span class="n">collections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sentinel-s2-l2a-cogs&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-105.694362</span><span class="p">,</span><span class="w">   </span><span class="m">39.912886</span><span class="p">,</span><span class="w">  </span><span class="m">-105.052774</span><span class="p">,</span><span class="w">    </span><span class="m">40.262785</span><span class="p">),</span>
<span class="w">                </span><span class="n">datetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-05-01/2021-06-30&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="nf">post_request</span><span class="p">()</span><span class="w"> </span>


<span class="n">col_2020</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stac_image_collection</span><span class="p">(</span><span class="n">items_2020</span><span class="o">$</span><span class="n">features</span><span class="p">,</span><span class="w"> </span><span class="n">asset_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assets</span><span class="p">)</span>
<span class="n">col_2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">stac_image_collection</span><span class="p">(</span><span class="n">items_2021</span><span class="o">$</span><span class="n">features</span><span class="p">,</span><span class="w"> </span><span class="n">asset_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assets</span><span class="p">)</span>

<span class="n">v_2020</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cube_view</span><span class="p">(</span><span class="n">srs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EPSG:32720&quot;</span><span class="p">,</span><span class="w">  </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2020-05-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2020-06-30&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="s">&quot;xmin&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="s">&quot;xmax&quot;</span><span class="p">],</span><span class="w">  </span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="s">&quot;ymax&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bbox_32720_boulder</span><span class="p">[</span><span class="s">&quot;ymin&quot;</span><span class="p">]),</span>
<span class="w">              </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;P1D&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">aggregation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;median&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">resampling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bilinear&quot;</span><span class="p">)</span>

<span class="n">v_2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cube_view</span><span class="p">(</span><span class="n">v_2020</span><span class="p">,</span><span class="w"> </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-05-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-06-30&quot;</span><span class="p">))</span>


<span class="n">max_ndvi_mosaic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">raster_cube</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">select_bands</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;B04&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B08&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">apply_pixel</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;(B08-B04)/(B08+B04)&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">names</span><span class="o">=</span><span class="s">&quot;NDVI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">reduce_time</span><span class="p">(</span><span class="s">&quot;max(NDVI)&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">stars</span><span class="p">))</span>
<span class="nf">max_ndvi_mosaic</span><span class="p">(</span><span class="n">col_2020</span><span class="p">,</span><span class="w"> </span><span class="n">v_2020</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">maxndvi_2020</span>

<span class="nf">max_ndvi_mosaic</span><span class="p">(</span><span class="n">col_2021</span><span class="p">,</span><span class="w"> </span><span class="n">v_2021</span><span class="p">)</span><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">maxndvi_2021</span>

<span class="n">maxndvi_2021</span>
<span class="n">maxndvi_2020</span>

<span class="n">difference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxndvi_2021</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">maxndvi_2020</span>
<span class="n">difference</span><span class="p">[</span><span class="n">difference</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">-0.15</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span>
<span class="nf">names</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Difference of max NDVI (2020 - 2019)&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">flood_polygon_data3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glue</span><span class="p">(</span><span class="s">&quot;/vsizip/vsicurl/https://data.hydrosheds.org/file/hydrosheds-associated/gloric/GloRiC_v10_shapefile.zip/GloRiC_v10_shapefile/GloRiC_v10.shp&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_read</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lon&quot;</span><span class="p">,</span><span class="s">&quot;lat&quot;</span><span class="p">))</span>

<span class="n">flood_polygon_data3</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">#st_read(&quot;/Users/ty/Downloads/GloRiC_v10_geodatabase/GloRiC_v10.gdb&quot;)</span>

<span class="n">flood_polygon_data3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glue</span><span class="p">(</span><span class="s">&quot;/vsizip/vsicurl/https://data.hydrosheds.org/file/hydrosheds-associated/gloric/GloRiC_v10_geodatabase.zip/GloRiC_v10_geodatabase/GloRiC_v10.gdb&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_read</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lon&quot;</span><span class="p">,</span><span class="s">&quot;lat&quot;</span><span class="p">))</span>

<span class="n">flood_polygon_data3</span>
</code></pre></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2024-05-16
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../move-data-to-instance/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Move and Save data" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Move and Save data
            </div>
          </div>
        </a>
      
      
        
        <a href="../stac_simple/" class="md-footer__link md-footer__link--next" aria-label="Next: Stream data (light)" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Stream data (light)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 University of Colorado Boulder
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "toc.integrate", "toc.follow", "content.code.copy"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>